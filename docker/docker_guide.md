# Running ESMValTool packaged in the docker container

## Install docker
Use official [Docker documentation](https://docs.docker.com/engine/installation/)

## Get docker image
All available docker images are listed on
[Docker Hub page](https://hub.docker.com/r/esmvalgroup/esmvaltool/tags/)
Before running container you need to pull the image to your machine.

```sh
# pull Ubuntu based image with version 1.1.0
docker pull esmvalgroup/esmvaltool:1.1.0-xenial
# pull CentOS based image with version 1.1.0
docker pull esmvalgroup/esmvaltool:1.1.0-centos7
# pull debian based image with version 1.1.0
docker pull esmvalgroup/esmvaltool:1.1.0-debian-8.5
```

## Running ESMValTool in the container
To run ESMValTool in the docker container you need to mount
necessary directories and provide the name of the namelist
to execute. ESMValTool expects specific directory structure
and directories for input and output files need to be created
in advance. Below are few user scenerios.

1. Input and output directories are located in the same directory.
```sh
docker run -v <local_data>:/data/ esmvalgroup/esmvaltool:<tag> nml/<namelist_name>.xml
```
Replace:
* `<tag>` with `1.1.0-centos7`, `1.1.0-xenial` or `1.1.0-debian-8.5`
    depending on which image
you want to use
* `<namelist_name>` with name of the namelist you want to execute
* `<local_data>` with  a location on your local machine
(docker host). It has to be absolute path.

Content of the `<local_data>`
directory has to have following structure:
```sh
tree <local_data>
<local_data>
├── in              # input direcotry
│   ├── datamodel   # model data
│   ├── obsdata     # observations
│   └── rawobsdata  # raw observations (unprocessed)
└── out             # output direcotry
    ├── climo       # path for intermediate files (netCDF)
    ├── plots       # generated plots
    ├── regridding  # intermediate files generated by regridding process
    └── work        # output data path (netCDF)
```

2. Input and output directories are in different locations.
If input and output directories are in different locations,
they need to be mounted separately.
```sh
docker run \
    -v <datamodel>:/data/in/datamodel \
    -v <obsdata>:/data/in/obsdata \
    -v <rowobsdata>:/data/in/rawobsdata \
    -v <climo>:/data/out/climo \
    -v <plots>:/data/out/plots \
    -v <regridding>:/data/out/regridding \
    -v <work>:/data/out/work \
    esmvalgroup/esmvaltool:<tag> nml/<namelist_name>.xml
```
Replace paths in angle brackets `< >` with appropriate values.
