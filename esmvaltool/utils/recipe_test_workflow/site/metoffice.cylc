#!jinja2

[runtime]
    [[root]]
        [[[environment]]]
            ESMVALCORE_DIR = ${CYLC_WORKFLOW_RUN_DIR}/share/lib/python/ESMValCore
            ESMVALTOOL_DIR = ${CYLC_WORKFLOW_RUN_DIR}/share/lib/python/ESMValTool
            PYTHONPATH_PREPEND = ${ESMVALCORE_DIR}:${ESMVALTOOL_DIR}

    # COMPUTE provides defaults for computation-heavy tasks.
    # Specific tasks below override some defaults, e.g. time & memory.
    [[COMPUTE]]
        platform = spice
        execution time limit = PT2M
        [[[directives]]]
            --wckey = RTW
            --ntasks = {{ MAX_PARALLEL_TASKS }}
            --mem = 2G

    [[configure]]
        platform = localhost

    [[get_esmval]]
        platform = localhost
        execution time limit = PT2M
        [[[directives]]]
            --mem = 2G

    {% for RECIPE in FAST_RECIPES %}
        {% if RECIPE['max_time'] != 'default' and RECIPE['max_memory'] != 'default' %}
        [[process<fast={{ RECIPE['recipe_path'] }}>]]
            execution time limit = {{ RECIPE['max_time'] }}
                [[[directives]]]
                    --mem = {{ RECIPE['max_memory'] }}
        {% endif %}
    {% endfor %}

    {% for RECIPE in MEDIUM_RECIPES %}
        {% if RECIPE['max_time'] != 'default' and RECIPE['max_memory'] != 'default' %}
        [[process<medium={{ RECIPE['recipe_path'] }}>]]
            execution time limit = {{ RECIPE['max_time'] }}
            [[[directives]]]
                --mem = {{ RECIPE['max_memory'] }}
        {% endif %}
    {% endfor %}
