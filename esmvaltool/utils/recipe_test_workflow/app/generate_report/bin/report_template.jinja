<!doctype html>
<html>
    <head>
        <title>Recipe Test Workflow</title>
        <link rel="icon" href="https://esmvaltool.org/favicon.ico">
    </head>
    <style>
        #recipes {
            font-family: Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        #recipes td, #recipes th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #recipes tr:nth-child(even){background-color: #f2f2f2;}

        #recipes tr:hover {background-color: #ddd;}

        #recipes th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: hsl(200, 50%, 50%);
            color: white;
        }
    </style>
    <body>
        <h1>Recipe Test Workflow - Last Run Status</h1>
        <h2>{{ subheader }}</h2>

        {% if sha_info %}
        <table id="recipes">
        <caption><h3>Commit SHAs</h3></caption>
            <tr>
                <th></th>
                <th>Tested Today</th>
                {% if sha_info['ESMValCore'].get('yesterday') and sha_info['ESMValTool'].get('yesterday') %}
                    <th>Tested Yesterday</th>
                {% endif %}
            </tr>
            {% for package, days in sha_info.items() %}
            <tr>
                <td>{{ package }}</td>
                <td>
                    <a href="https://github.com/ESMValGroup/{{ package }}/commit/{{ days['today'] }}">{{ days['today'] }}</a>
                </td>
                {% if days.get('yesterday') %}
                <td>
                    <a href="https://github.com/ESMValGroup/{{ package }}/commit/{{ days['yesterday'] }}">{{ days['yesterday'] }}</a>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </table>
        {% endif %}

        {% if esmval_core_commits %}
        <table id="recipes">
            <caption><h2>ESMValCore Commits</h2></caption>
                <tr>
                    <th></th>
                    <th>Time</th>
                    <th>SHA</th>
                    <th>Author</th>
                    <th>Commit message</th>
                </tr>
                {% for commit in esmval_core_commits %}
                <tr>
                    {% if commit['report_flag'] %}
                    <td align="right" style="color: hotpink; font-weight: bold;">{{ commit['report_flag'] }}</td>
                    {% else %}
                    <td></td>
                    {% endif %}
                    <td>{{ commit['date'] }}</td>
                    <td><a href="https://github.com/ESMValGroup/ESMValCore/commit/{{ commit['sha'] }}">{{ commit['sha'] }}</a></td>
                    <td>{{ commit['author'] }} </td>
                    <td>{{ commit['message']}} </td>
                </tr>
                {% endfor %}
        </table>
        {% endif %}

        {% if esmval_tool_commits %}
        <table id="recipes">
            <caption><h2>ESMValTool Commits</h2></caption>
            <tr>
                <th></th>
                <th>Time</th>
                <th>SHA</th>
                <th>Author</th>
                <th>Commit message</th>
            </tr>
            {% for commit in esmval_tool_commits %}
                    <tr>
                        {% if commit['report_flag'] %}
                        <td align="right" style="color: hotpink; font-weight: bold;">{{ commit['report_flag'] }}</td>
                        {% else %}
                        <td></td>
                        {% endif %}
                        <td>{{ commit['date'] }}</td>
                        <td><a href="https://github.com/ESMValGroup/ESMValTool/commit/{{ commit['sha'] }}">{{ commit['sha'] }}</a></td>
                        <td>{{ commit['author'] }} </td>
                        <td>{{ commit['message']}} </td>
                    </tr>
            {% endfor %}
        </table>
        {% endif %}
        <br>
        <table id="recipes">
            <caption><h2>Test Results</h2></caption>
            <tr>
                <th>Recipe</th>
                <th>Recipe Run</th>
                <th>Compare KGOs</th>
            </tr>
            {% for recipe, tasks in report_data.items() %}
            <tr>
                <td>{{ recipe }}</td>
                <td style="{{ tasks.get('process_task', {}).get('style', 'color: black') }}">{{ tasks.get('process_task', {}).get('status', '-') }}</td>
                <td style="{{ tasks.get('compare_task', {}).get('style', 'color: black') }}">{{ tasks.get('compare_task', {}).get('status', '-') }}</td>
            </tr>
            {% endfor %}
        </table>
    </body>
    <footer>
        <div style="text-align: center;">
            <a
                href="https://www.dkrz.de/en/about-en/contact/impressum"
                target="_blank"
            >Imprint</a> and
            <a
                href="https://www.dkrz.de/en/about-en/contact/en-datenschutzhinweise"
                target="_blank"
            >Privacy Policy</a>
        </div>
    </footer>
</html>
