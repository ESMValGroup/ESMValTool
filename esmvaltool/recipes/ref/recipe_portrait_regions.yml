# ESMValTool
---
documentation:
  title: Performance metrics plots for several regions using extract_shape.
  description: >
    Compare performance of simulations to a reference dataset.
  authors:
    - cammarano_diego
    - lindenlaub_lukas
    - weigel_katja
  maintainer:
    - lindenlaub_lukas
  references:
    - eyring21ipcc
    - gleckler08jgr

datasets:
  # cmip6
  # - {dataset: ACCESS-ESM1-5, institute: CSIRO}
  - {dataset: MPI-ESM1-2-HR}

        # regions: ['GLOB',
        #           'NWN', 'NEN', 'GIC', 'WNA', 'CNA', 'ENA', 'NCA', 'SCA', 'CAR', # North America
        #           'NWS', 'NSA', 'NES', 'SAM', 'SWS', 'SES', 'SSA', # South America
        #           'NEU', 'WCE', 'EEU', 'MED', # Europe + MED
        #           'SAH', 'WAF', 'CAF', 'NEAF', 'SEAF', 'WSAF', 'ESAF', 'MDG', # Africa
        #           'RAR', 'WSB', 'ESB', 'RFE', 'WCA', 'ECA', 'TIB', 'EAS', 'ARP', 'SAS', 'SEA', #Asia
        #           'NAU', 'CAU', 'EAU', 'SAU', 'NZ', # Ausltralia + NZ
        #           'WAN', 'EAN']  # Antarctic

preprocessors:
  default: &default  # common preprocessor settings
    regrid:
      target_grid: 1x1
      scheme: linear
    distance_metric:
      metric: weighted_rmse
    climate_statistics:
      operator: mean
      period: month
    mask_fillvalues:
      threshold_fraction: 0.95
  WCA:
    <<: *default
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [WCA]}
  ECA:
    <<: *default
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [ECA]}
  CNA:
    <<: *default
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [CNA]}
  ENA:
    <<: *default
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [ENA]}
  MED:
    <<: *default
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [MED]}
  SAH:
    <<: *default
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [SAH]}
  WCE:
    <<: *default
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [WCE]}

  default_200: &default_200  # common preprocessor settings
    extract_levels:
      levels: 20000
      scheme: linear
      coordinate: air_pressure
    regrid:
      target_grid: 1x1
      scheme: linear
    distance_metric:
      metric: weighted_rmse
    climate_statistics:
      operator: mean
      period: month
    mask_fillvalues:
      threshold_fraction: 0.95
  ECA_200:
    <<: *default_200
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [ECA]}
  WCA_200:
    <<: *default_200
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [WCA]}
  CNA_200:
    <<: *default_200
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [CNA]}
  ENA_200:
    <<: *default_200
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [ENA]}
  MED_200:
    <<: *default_200
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [MED]}
  SAH_200:
    <<: *default_200
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [SAH]}
  WCE_200:
    <<: *default_200
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [WCE]}



var_default: &var_default
  mip: Amon
  project: CMIP6
  exp: historical
  ensemble: r1i1p1f1
  grid: gn
  start_year: 2001
  end_year: 2014
  split: Ref1  # first triangle

diagnostics:
  portrait_rmse:
    themes: [aerosols, phys, clouds, atmDyn, chem, ghg]
    realms: [atmos, land, atmosChem, ocean]
    variables:
      tas_ECA: &tas
        <<: *var_default
        short_name: tas
        variable: tas
        preprocessor: ECA
        ppregion: ECA
        additional_datasets:
          - {dataset: HadCRUT5, project: OBS, type: ground,
             version: 5.0.1.0-analysis, tier: 2,
             reference_for_metric: true}
        tag: Asia
      tas_ECA_2: &tas_2
        <<: *tas
        split: Ref2
        additional_datasets:
          - {dataset: ERA5, project: native6, type: reanaly, version: v1,
             tier: 3, reference_for_metric: true}
        tag: Asia
      tas_ENA:
        <<: *tas
        ppregion: ENA
        preprocessor: ENA
        tag: North and Central America
      tas_ENA_2:
        <<: *tas_2
        ppregion: ENA
        preprocessor: ENA
        tag: North and Central America
      tas_CNA:
        <<: *tas
        ppregion: CNA
        preprocessor: CNA
        tag: North and Central America
      tas_CNA_2:
        <<: *tas_2
        ppregion: CNA
        preprocessor: CNA
        tag: North and Central America
      tas_MED:
        <<: *tas
        short_name: tas
        ppregion: MED
        preprocessor: MED
        tag: MED
      tas_MED_2:
        <<: *tas_2
        short_name: tas
        ppregion: MED
        preprocessor: MED
        tag: MED
      tas_SAH:
        <<: *tas
        ppregion: SAH
        preprocessor: SAH
        tag: Africa
      tas_SAH_2:
        <<: *tas_2
        ppregion: SAH
        preprocessor: SAH
        tag: Africa
      tas_WCE:
        <<: *tas
        short_name: tas
        ppregion: WCE
        preprocessor: WCE
        tag: Europe
      tas_WCE_2:
        <<: *tas_2
        short_name: tas
        ppregion: WCE
        preprocessor: WCE
        tag: Europe

      pr_ECA: &pr
        <<: *var_default
        short_name: pr
        variable: pr
        preprocessor: ECA
        ppregion: ECA
        split: Ref1
        additional_datasets:
          - {dataset: GPCP-SG, project: OBS, type: atmos, version: 2.3,
             tier: 2, reference_for_metric: true}
        tag: Asia
      pr_ECA_2: &pr_2
        <<: *pr
        split: Ref2
        additional_datasets:
          - {dataset: ERA5, project: native6, type: reanaly, version: v1,
             tier: 3, reference_for_metric: true}
        tag: Asia
      pr_ENA:
        <<: *pr
        ppregion: ENA
        preprocessor: ENA
        tag: North and Central America
      pr_ENA_2:
        <<: *pr_2
        ppregion: ENA
        preprocessor: ENA
        tag: North and Central America
      pr_CNA:
        <<: *pr
        ppregion: CNA
        preprocessor: CNA
        tag: North and Central America
      pr_CNA_2:
        <<: *pr_2
        ppregion: CNA
        preprocessor: CNA
        tag: North and Central America
      pr_MED:
        <<: *pr
        ppregion: MED
        preprocessor: MED
        tag: MED
      pr_MED_2:
        <<: *pr_2
        ppregion: MED
        preprocessor: MED
        tag: MED
      pr_SAH:
        <<: *pr
        ppregion: SAH
        preprocessor: SAH
        tag: Africa
      pr_SAH_2:
        <<: *pr_2
        ppregion: SAH
        preprocessor: SAH
        tag: Africa
      pr_WCE:
        <<: *pr
        ppregion: WCE
        preprocessor: WCE
        tag: Europe
      pr_WCE_2:
        <<: *pr_2
        ppregion: WCE
        preprocessor: WCE
        tag: Europe

      psl_ECA: &psl
        <<: *var_default
        short_name: psl
        variable: psl
        preprocessor: ECA
        ppregion: ECA
        additional_datasets:
          - {dataset: ERA5, project: native6, type: reanaly, version: v1,
             tier: 3, reference_for_metric: true}
        tag: Asia
      psl_ENA:
        <<: *psl
        ppregion: ENA
        preprocessor: ENA
        tag: North and Central America
      psl_CNA:
        <<: *psl
        ppregion: CNA
        preprocessor: CNA
        tag: North and Central America
      psl_MED:
        <<: *psl
        ppregion: MED
        preprocessor: MED
        tag: MED
      psl_SAH:
        <<: *psl
        ppregion: SAH
        preprocessor: SAH
        tag: Africa
      psl_WCE:
        <<: *psl
        ppregion: WCE
        preprocessor: WCE
        tag: Europe

      hus_ECA: &hus
        <<: *var_default
        short_name: hus
        variable: hus200
        preprocessor: ECA_200
        ppregion: ECA
        additional_datasets:
          - {dataset: ERA5, project: native6, type: reanaly, version: v1,
             tier: 3, reference_for_metric: true}
        tag: Asia
      hus_ENA:
        <<: *hus
        ppregion: ENA
        preprocessor: ENA_200
        tag: North and Central America
      hus_CNA:
        <<: *hus
        ppregion: CNA
        preprocessor: CNA_200
        tag: North and Central America
      hus_MED:
        <<: *hus
        ppregion: MED
        preprocessor: MED_200
        tag: MED
      hus_SAH:
        <<: *hus
        ppregion: SAH
        preprocessor: SAH_200
        tag: Africa
      hus_WCE:
        <<: *hus
        ppregion: WCE
        preprocessor: WCE_200
        tag: Europe

      ua_ECA: &ua
        <<: *var_default
        short_name: ua
        variable: ua200
        preprocessor: ECA_200
        ppregion: ECA
        additional_datasets:
          - {dataset: ERA5, project: native6, type: reanaly, version: v1,
             tier: 3, reference_for_metric: true}
        tag: Asia
      ua_ENA:
        <<: *ua
        ppregion: ENA
        preprocessor: ENA_200
        tag: North and Central America
      ua_CNA:
        <<: *ua
        ppregion: CNA
        preprocessor: CNA_200
        tag: North and Central America
      ua_MED:
        <<: *ua
        ppregion: MED
        preprocessor: MED_200
        tag: MED
      ua_SAH:
        <<: *ua
        ppregion: SAH
        preprocessor: SAH_200
        tag: Africa
      ua_WCE:
        <<: *ua
        ppregion: WCE
        preprocessor: WCE_200
        tag: Europe

    scripts:
      portrait:
        script: portrait_plot.py
        x_by: ppregion  # extra_facet
        y_by: variable #short_name
        group_by: tag
        normalize: "centered_median"
        # default_split: Ref1
        nan_color: null
        plot_kwargs:
          vmin: -0.5
          vmax: +0.5
        cbar_kwargs:
          label: Relative RMSE
          extend: both
