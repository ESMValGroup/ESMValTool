# ESMValTool
---
documentation:
  title: Model evaluation with focus on clouds.
  description: >
    Plot 2D histograms using the Seaborn diagnostic in ESMValTool.
  authors:
    - bock_lisa
    - lauer_axel
  maintainer:
    - bock_lisa

timerange_for_models: &time_period
  timerange: '2005/2005'  # can be specified, this is just an example

preprocessors:
  common_grid:
    regrid:
      target_grid: 1x1
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted

diagnostics:
  plot_joint_clt_lwcre:
    description: Scatterplot clt vs lwcre.
    variables: &vars_clt_lwcre
      clt:
        mip: Amon
        exp: historical
        ensemble: r1i1p1
        preprocessor: common_grid
        <<: *time_period
      lwcre:
        mip: Amon
        derive: true
        force_derivation: false
        exp: historical
        ensemble: r1i1p1
        preprocessor: common_grid
        <<: *time_period
    additional_datasets:
      - {dataset: CESM2, project: CMIP6, grid: gn, ensemble: r1i1p1f1, alias: CESM2}
    scripts:
      plot: &plot_settings_jointplot
        script: seaborn_diag.py
        seaborn_func: jointplot
        title: 
        seaborn_kwargs:
          kind: hist
          x: clt
          y: lwcre                 # Adjust binning for histograms
          binwidth: [5., 5.]
          binrange: [[0., 100.], [-10., 120.]]
          xlim: [0., 100.]
          ylim: [-10., 120.]
          vmax: 0.02
          stat: probability
          cmap: YlGnBu
          cbar: True
          cbar_kws:
            extend: 'max'
          marginal_ticks: True
          marginal_kws:
            color: darkturquoise
            binwidth: 5.
            #binrange: [[0., 100.], [-10., 120.]]
            fill: True
            stat: probability
          #marg_x_kws:
          #  binwidth: 5
          #  binrange: [0., 100.]
          #marg_y_kws:
          #  binwidth: 5
          #  binrange: [-10., 120.]
        add_aux_coords: true
        #dropna_kwargs:
        #  axis: 0
        #  how: any
        plot_object_methods:
          set_axis_labels:
            xlabel: 'clt [%]'
            ylabel: 'lwcre [W m-2]'
          #set_title: '{alias}'
        seaborn_settings:
          style: ticks
          rc:
            axes.titlepad: 15.0
        suptitle: 'CESM2'

  plot_joint_clt_lwcre_ref:
    description: Scatterplot clt vs lwcre.
    variables:
      <<: *vars_clt_lwcre
    additional_datasets:
      - {dataset: ESACCI-CLOUD, project: OBS, type: sat, version: AVHRR-AMPM-fv3.0, tier: 2, alias: ESACCI-CLOUD}
    scripts:
      plot:
        <<: *plot_settings_jointplot
        suptitle: 'ESACCI-CLOUD'

  plot_hist_with_ref_clt_lwcre:
    description: Scatterplot clt vs swcre with reference.
    variables:
      <<: *vars_clt_lwcre
    additional_datasets:
      - {dataset: ESACCI-CLOUD, project: OBS, type: sat, version: AVHRR-AMPM-fv3.0, tier: 2, alias: ESACCI-CLOUD}
      - {dataset: CESM2, project: CMIP6, grid: gn, ensemble: r1i1p1f1, alias: CESM2-WACCM}
    scripts:
      plot:
        script: seaborn_diag.py
        seaborn_func: displot
        seaborn_kwargs:
          kind: hist
          col: alias                # Creates side-by-side plots for each dataset
          x: clt
          y: lwcre
          binwidth: [5., 5.]
          binrange: [[0., 100.], [-10., 120.]]
          facet_kws:
            xlim: [0., 100.]
            ylim: [-10., 120.]
          vmax: 0.02
          height: 5                   # Set height of each subplot
          aspect: 1.2                 # Set aspect ratio
          stat: probability 
          common_norm: True
          cmap: YlGnBu
          cbar: True                  # Includes a color bar
          cbar_kws:
            label: "Probability"
            extend: 'max'
        add_aux_coords: true
        #dropna_kwargs:
        #  axis: 0
        #  how: any
        plot_object_methods:
          set_axis_labels:
            xlabel: 'clt [%]'
            ylabel: 'swcre [W m-2]'
        seaborn_settings:
          style: ticks
          rc:
            axes.titlepad: 15.0