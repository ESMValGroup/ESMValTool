# ESMValTool
# recipe_perfmetrics_CMIP5.yml
---
documentation:
  title: Performance metrics for essential climate variables in CMIP5

  description: |
    Recipe for plotting the performance metrics for the CMIP5 datasets,
    including the standard ECVs as in Gleckler et al., and some additional
    variables (like ozone, sea-ice, aerosol...)

  authors:
    - winterstein_franziska
    - righi_mattia
    - eyring_veronika
    - ruhe_lukas

  maintainer:
    - ruhe_lukas

  references:
    - gleckler08jgr

  projects:
    - esmval
    - embrace
    - crescendo
    - c3s-magic
    - cmug

preprocessors:
  ppNOLEV1:
    regrid:
      target_grid: reference_dataset
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.95
    # multi_model_statistics:
    #   span: overlap
    #   statistics: [mean, median]
    #   exclude: [reference_dataset]

  rmse:  &rmse
    custom_order: true
    regrid:
      # target_grid: reference_dataset
      scheme: linear
      target_grid: 3x3
      # scheme: nearest
    regrid_time:
      calendar: standard
      frequency: mon
    mask_fillvalues:
      threshold_fraction: 0.95
    # multi_model_statistics:
    #   span: overlap
    #   statistics: [mean, median]
    #   exclude: [reference_dataset, alternative_dataset]
    distance_metric:
      metric: rmse

  pp500:
    # <<: *rmse
    custom_order: true
    regrid:
      target_grid: 3x3
      scheme: linear
    extract_levels:
      levels: 50000
      scheme: linear
    regrid_time:
      calendar: standard
      frequency: mon
    mask_fillvalues:
      threshold_fraction: 0.95
    distance_metric:
      metric: rmse

diagnostics:
  perfmetrics:
    description: Near-surface air temperature
    themes:
      - phys
    realms:
      - atmos
    variables:
      tas: &var_default
        preprocessor: rmse
        reference_dataset: ERA-Interim
        # alternative_dataset: NCEP-NCAR-R1
        mip: Amon
        split: Ref
        y_label: tas_Glob
        project: CMIP5
        exp: historical
        ensemble: r1i1p1
        start_year: 2000
        end_year: 2002
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS6, type: reanaly,
            version: 1, tier: 3, reference_for_metric: true}
      tas_alt:
        <<: *var_default
        short_name: tas
        y_label: tas_Glob
        split: Alt
        additional_datasets:
          - {dataset: NCEP-NCAR-R1, project: OBS6, type: reanaly,
            version: 1, tier: 2, reference_for_metric: true}
      pr:
        <<: *var_default
        y_label: pr_Glob
        reference_dataset: GPCP-V2.2
        additional_datasets:
          - {dataset: GPCP-V2.2, project: obs4MIPs, level: L3, tier: 1, reference_for_metric: true}
      
      # swcre:
      #   <<: *var_default
      #   derive: true
      #   force_derivation: false
      #   y_label: swcre_Glob
      #   additional_datasets:
      #     - {dataset: CERES-EBAF, project: obs4MIPs, level: L3B,
      #       tier: 1, reference_for_metric: true}
      
      # rlut:
      #   <<: *var_default
      #   y_label: rlut_Glob
      #   additional_datasets:
      #     - {dataset: CERES-EBAF, project: obs4MIPs, level: L3B,
      #       tier: 1, reference_for_metric: true, start_year: 2000, end_year: 2002}  34 vs 36 month dataa.. 2 months missing in obs??
        
      zg:
        <<: *var_default
        y_label: zg_Glob-500
        preprocessor: pp500
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS6, type: reanaly,
            version: 1, tier: 3, reference_for_metric: true}

    additional_datasets:
      - {dataset: ACCESS1-0}
      - {dataset: ACCESS1-3}
      - {dataset: bcc-csm1-1}
      - {dataset: bcc-csm1-1-m}
      - {dataset: BNU-ESM}
      - {dataset: CanCM4}
      - {dataset: CanESM2}
      - {dataset: CCSM4}
      - {dataset: CESM1-BGC}
      - {dataset: CESM1-CAM5}
      - {dataset: CESM1-FASTCHEM}
      - {dataset: CESM1-WACCM}
      - {dataset: CMCC-CESM}
      - {dataset: CMCC-CM}
      - {dataset: CMCC-CMS}
      - {dataset: CNRM-CM5}
      # - {dataset: CNRM-CM5-2}  # not in example plot
      - {dataset: CSIRO-Mk3-6-0}
      - {dataset: EC-EARTH, ensemble: r6i1p1}
      - {dataset: FGOALS-g2}
      # - {dataset: FGOALS-s2}
      - {dataset: FIO-ESM}
      - {dataset: GFDL-CM2p1}
      - {dataset: GFDL-CM3}
      - {dataset: GFDL-ESM2G}
      - {dataset: GFDL-ESM2M}
      - {dataset: GISS-E2-H, ensemble: r1i1p2}
      # - {dataset: GISS-E2-H-CC}  # not in example plot
      - {dataset: GISS-E2-R, ensemble: r1i1p2}
      # - {dataset: GISS-E2-R-CC}  # not in example plot
      - {dataset: HadCM3}
      - {dataset: HadGEM2-AO}
      - {dataset: HadGEM2-CC}
      - {dataset: HadGEM2-ES}
      - {dataset: inmcm4}
      - {dataset: IPSL-CM5A-LR}
      - {dataset: IPSL-CM5A-MR}
      - {dataset: IPSL-CM5B-LR}
      - {dataset: MIROC4h}
      - {dataset: MIROC5}
      - {dataset: MIROC-ESM}
      - {dataset: MIROC-ESM-CHEM}
      - {dataset: MPI-ESM-LR}
      # - {dataset: MPI-ESM-MR}  # not in example plot
      - {dataset: MPI-ESM-P}
      - {dataset: MRI-CGCM3}
      - {dataset: MRI-ESM1}
      - {dataset: NorESM1-M}
      - {dataset: NorESM1-ME}
      # - {dataset: ERA-Interim, project: OBS6, type: reanaly,
      #    version: 1, tier: 3, reference_for_metric: true}
      # - {dataset: NCEP-NCAR-R1, project: OBS6, type: reanaly,
      #    version: 1, tier: 2}
    scripts:
      portrait:
        script: perfmetrics/portrait_plot.py
        y_by: y_label
        x_by: dataset
        plot_kwargs:
          vmin: -0.5
          vmax: 0.5
        normalize: centered_median  # default
        default_split: Alt

  ### pr: PRECIPITATION #######################################################
  # pr:
  #   description: Precipitation
  #   themes:
  #     - phys
  #   realms:
  #     - atmos
  #   variables:
  #     pr:
  #       preprocessor: ppNOLEV1
  #       reference_dataset: GPCP-V2.2
  #       mip: Amon
  #       project: CMIP5
  #       exp: historical
  #       ensemble: r1i1p1
  #       start_year: 2000
  #       end_year: 2002
  #   additional_datasets:
  #     - {dataset: ACCESS1-0}
  #     - {dataset: ACCESS1-3}
  #     - {dataset: bcc-csm1-1}
  #     - {dataset: bcc-csm1-1-m}
  #     - {dataset: BNU-ESM}
  #     - {dataset: CanCM4}
  #     - {dataset: CanESM2}
  #     - {dataset: CCSM4}
  #     - {dataset: CESM1-BGC}
  #     - {dataset: CESM1-CAM5}
  #     - {dataset: CESM1-CAM5-1-FV2}
  #     - {dataset: CESM1-FASTCHEM}
  #     - {dataset: CESM1-WACCM}
  #     - {dataset: CMCC-CESM}
  #     - {dataset: CMCC-CM}
  #     - {dataset: CMCC-CMS}
  #     - {dataset: CNRM-CM5}
  #     - {dataset: CNRM-CM5-2}
  #     - {dataset: CSIRO-Mk3-6-0}
  #     - {dataset: EC-EARTH, ensemble: r6i1p1}
  #     - {dataset: FGOALS-g2}
  #     - {dataset: FIO-ESM}
  #     - {dataset: GFDL-CM2p1}
  #     - {dataset: GFDL-CM3}
  #     - {dataset: GFDL-ESM2G}
  #     - {dataset: GFDL-ESM2M}
  #     - {dataset: GISS-E2-H, ensemble: r1i1p2}
  #     - {dataset: GISS-E2-H-CC}
  #     - {dataset: GISS-E2-R, ensemble: r1i1p2}
  #     - {dataset: GISS-E2-R-CC}
  #     - {dataset: HadCM3}
  #     - {dataset: HadGEM2-AO}
  #     - {dataset: HadGEM2-CC}
  #     - {dataset: HadGEM2-ES}
  #     - {dataset: inmcm4}
  #     - {dataset: IPSL-CM5A-LR}
  #     - {dataset: IPSL-CM5A-MR}
  #     - {dataset: IPSL-CM5B-LR}
  #     - {dataset: MIROC4h}
  #     - {dataset: MIROC5}
  #     - {dataset: MIROC-ESM}
  #     - {dataset: MIROC-ESM-CHEM}
  #     - {dataset: MPI-ESM-LR}
  #     - {dataset: MPI-ESM-MR}
  #     - {dataset: MPI-ESM-P}
  #     - {dataset: MRI-CGCM3}
  #     - {dataset: MRI-ESM1}
  #     - {dataset: NorESM1-M}
  #     - {dataset: NorESM1-ME}
  #     - {dataset: GPCP-V2.2, project: obs4MIPs, level: L3, tier: 1}
  #   scripts:
  #     grading:
  #       <<: *grading_settings
