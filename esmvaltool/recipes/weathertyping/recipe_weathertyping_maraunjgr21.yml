documentation:
  title: Weathertyping algorithm

  description: |
    A diagnostic to calculate Lamb weathertypes over a given region. Furthermore, 
    correlations between weathertypes and precipitation patterns over a given are can be calculated 
    and 'combined' or 'simplified' weathertypes can be derived. Additionally, mean fields, as well as
    anomalies and standard deviations can be plotted.

  authors:
    - jury_martin
    - kroissenbrunner_thomas

  maintainer:
    - kroissenbrunner_thomas

  projects:
    - preval

  references:
    - maraun21jgr
    - jones93ijc

datasets_psl_cordex: &datasets_psl_cordex
  - {domain: EUR-11, institute: CLMcom, dataset: CCLM4-8-17, ensemble: r1i1p1, rcm_version: v1, latestversion: v20140515, driver: CNRM-CERFACS-CNRM-CM5}
  - {domain: EUR-11, institute: CLMcom, dataset: CCLM4-8-17, ensemble: r12i1p1, rcm_version: v1, latestversion: v20140515, driver: ICHEC-EC-EARTH}
  - {domain: EUR-11, institute: KNMI, dataset: RACMO22E, ensemble: r1i1p1, rcm_version: v1, latestversion: v20140313, driver: ICHEC-EC-EARTH}
  - {domain: EUR-11, institute: SMHI, dataset: RCA4, ensemble: r12i1p1, rcm_version: v1, latestversion: v20131026, driver: ICHEC-EC-EARTH}
  - {domain: EUR-11, institute: SMHI, dataset: RCA4, ensemble: r1i1p1, rcm_version: v1, latestversion: v20131026, driver: IPSL-IPSL-CM5A-MR}
  - {domain: EUR-11, institute: SMHI, dataset: RCA4, ensemble: r1i1p1, rcm_version: v1, latestversion: v20131026, driver: CNRM-CERFACS-CNRM-CM5}
  - {domain: EUR-11, institute: CLMcom, dataset: CCLM4-8-17, ensemble: r1i1p1, rcm_version: v1, latestversion: v20150320, driver: MOHC-HadGEM2-ES}
  - {domain: EUR-11, institute: SMHI, dataset: RCA4, ensemble: r1i1p1, rcm_version: v1, latestversion: v20131026, driver: MOHC-HadGEM2-ES}
  - {domain: EUR-11, institute: CLMcom, dataset: CCLM4-8-17, ensemble: r1i1p1, rcm_version: v1, latestversion: v20140515, driver: MPI-M-MPI-ESM-LR}
  - {domain: EUR-11, institute: SMHI, dataset: RCA4, ensemble: r1i1p1, rcm_version: v1a, latestversion: v20160803, driver: MPI-M-MPI-ESM-LR}
  #- {domain: EUR-11, institute: DMI, dataset: HIRHAM5, ensemble: r13i1p1, rcm_version: v1, latestversion: v20181126, driver: ICHEC-EC-EARTH} #?
  #- {domain: EUR-11, institute: IPSL, dataset: WRF331F, ensemble: r1i1p1, rcm_version: v1, latestversion: v20131026, driver: IPSL-IPSL-CM5A-MR} #?

datasets_ERA5: &datasets_era5
  - {project: native6, dataset: ERA5, type: reanaly, frequency: day, latestversion: v1, mip: day, tier: 3, start_year: 1958, end_year: 2014}

datasets_EOBS: &datasets_EOBS
  - {dataset: E-OBS, project: OBS, version: v29.0e-0.25, type: ground, tier: 2, start_year: 1958, end_year: 2014, mip: day}

preprocessors:
  weathertype_preproc:
    extract_time: &time
      start_year: 1950
      start_month: 1
      start_day: 1
      end_year: 2014
      end_month: 12
      end_day: 31
    regrid:
      target_grid: &grid
        start_longitude: -5
        end_longitude: 25
        step_longitude: 5
        start_latitude: 35
        end_latitude: 55
        step_latitude: 5
      scheme: linear

  weathertype_preproc_pr:
    extract_time: 
      *time
    extract_region: #choose region which will be used for weathertype and precipitation correlation
      start_longitude: 9.5
      end_longitude: 17.25
      start_latitude: 46.25
      end_latitude: 49

  mean_preproc:
    extract_time: 
      *time
    extract_region: &reg
      start_longitude: -15
      end_longitude: 35
      start_latitude: 25
      end_latitude: 65    

diagnostics:
  weathertyping:
    description: calculate weathertypes and plot means
    variables:
      era5_msl_wt: &era5_msl_wt
        project: native6
        dataset: ERA51
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: psl
        preprocessor: weathertype_preproc
        additional_datasets:
          *datasets_era5

      era5_pr_wt: &era5_pr_wt
        project: native6
        dataset: ERA51
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: pr
        preprocessor: weathertype_preproc_pr
        additional_datasets:
          *datasets_era5    

      eobs_pr_wt: &eobs_pr_wt
        project: OBS
        dataset: E-OBS
        type: ground
        mip: day
        version: v29.0e-0.25
        tier: 2
        start_year: 1958
        end_year: 2014
        short_name: pr
        preprocessor: weathertype_preproc_pr
        additional_datasets:
          *datasets_EOBS

      era5_msl_mean: &era5_msl
        project: native6
        dataset: ERA5
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: psl
        preprocessor: mean_preproc
        additional_datasets:
          *datasets_era5

      era5_tp_mean: &era5_prcp
        project: native6
        dataset: ERA5
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: pr
        preprocessor: mean_preproc
        additional_datasets:
          *datasets_era5
          
      era5_tas_mean: &era5_temp
        project: native6
        dataset: ERA5
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: tas
        preprocessor: mean_preproc
        additional_datasets:
          *datasets_era5

      cordex_historical_psl_day_wt: &cordex_historical_wt
        project: CORDEX
        activity: CMIP
        exp: historical
        mip: day
        short_name: psl
        preprocessor: weathertype_preproc
        start_year: 1970
        end_year: 2005
        additional_datasets:
          *datasets_psl_cordex
      
      cordex_historical_psl_day_mean: &cordex_historical_psl
        project: CORDEX
        activity: CMIP
        exp: historical
        mip: day
        short_name: psl
        preprocessor: mean_preproc
        start_year: 1970
        end_year: 2005
        additional_datasets:
          *datasets_psl_cordex

      cordex_historical_prcp_day_mean: &cordex_historical_prcp
        project: CORDEX
        activity: CMIP
        exp: historical
        mip: day
        short_name: pr
        preprocessor: mean_preproc
        start_year: 1970
        end_year: 2005
        additional_datasets:
          *datasets_psl_cordex
      
      cordex_historical_temp_day_mean: &cordex_historical_ta
        project: CORDEX
        activity: CMIP
        exp: historical
        mip: day
        short_name: tas
        preprocessor: mean_preproc
        start_year: 1970
        end_year: 2005
        additional_datasets:
          *datasets_psl_cordex

    scripts:
      weathertyping:
        correlation_threshold: 0.9
        rmse_threshold: 0.002
        automatic_slwt: true
        predefined_slwt: {1: [1, 2, 19], 2: [3, 4, 22, 21], 3: [5, 6, 15, 16], 4: [7, 8, 11, 18], 5: [9, 17], 6: [10, 20], 7: [12, 13, 14], 8: [23, 24], 9: [25, 26], 0: [27]}
        plotting: true
        script: weathertyping/weathertyping.py
