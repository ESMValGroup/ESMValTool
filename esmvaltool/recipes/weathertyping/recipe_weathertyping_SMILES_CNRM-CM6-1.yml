documentation:
  title: Weathertyping algorithm

  description: |
    A diagnostic to calculate Lamb weathertypes over a given region. Furthermore, 
    correlations between weathertypes and precipitation patterns over a given are can be calculated 
    and 'combined' or 'simplified' weathertypes can be derived. Additionally, mean fields, as well as
    anomalies and standard deviations can be plotted.

  authors:
    - jury_martin
    - kroissenbrunner_thomas

  maintainer:
    - kroissenbrunner_thomas

  projects:
    - preval

  references:
    - maraun21jgr
    - jones93ijc

datasets_psl_CMIP6: &datasets_psl_cmip6
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r7i1p1f2, grid: gr, esgf_version: v20190125}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r25i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r12i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r28i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r6i1p1f2, grid: gr, esgf_version: v20190125}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r24i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r13i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r9i1p1f2, grid: gr, esgf_version: v20190125}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r27i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r5i1p1f2, grid: gr, esgf_version: v20190125}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r10i1p1f2, grid: gr, esgf_version: v20190125}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r8i1p1f2, grid: gr, esgf_version: v20190125}
  #- {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r26i1p1f2, grid: gr, esgf_version: v20191004} #no tas?
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r4i1p1f2, grid: gr, esgf_version: v20190125}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r11i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r30i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r21i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r3i1p1f2, grid: gr, esgf_version: v20190125}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r16i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r20i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r2i1p1f2, grid: gr, esgf_version: v20181126}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r17i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r1i1p1f2, grid: gr, esgf_version: v20180917}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r23i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r14i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r18i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r22i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r15i1p1f2, grid: gr, esgf_version: v20191004}
  - {institute: CNRM-CERFACS, dataset: CNRM-CM6-1, ensemble: r19i1p1f2, grid: gr, esgf_version: v20191004}

datasets_ERA5: &datasets_era5
  - {project: native6, dataset: ERA5, type: reanaly, frequency: day, latestversion: v1, mip: day, tier: 3, start_year: 1958, end_year: 2014}

datasets_EOBS: &datasets_EOBS
  - {dataset: E-OBS, project: OBS, version: v29.0e-0.25, type: ground, tier: 2, start_year: 1958, end_year: 2014, mip: day}

preprocessors:
  weathertype_preproc:
    extract_time: &time
      start_year: 1950
      start_month: 1
      start_day: 1
      end_year: 2014
      end_month: 12
      end_day: 31
    regrid:
      target_grid: &grid
        start_longitude: -5
        end_longitude: 25
        step_longitude: 5
        start_latitude: 35
        end_latitude: 55
        step_latitude: 5
      scheme: linear

  weathertype_preproc_pr:
    extract_time: 
      *time
    extract_region: #choose region which will be used for weathertype and precipitation correlation
      start_longitude: 9.5
      end_longitude: 17.25
      start_latitude: 46.25
      end_latitude: 49

  mean_preproc:
    extract_time: 
      *time
    extract_region: &reg
      start_longitude: -15
      end_longitude: 35
      start_latitude: 25
      end_latitude: 65    

diagnostics:
  weathertyping:
    description: calculate weathertypes and plot means
    variables:
      era5_msl_wt: &era5_msl_wt
        project: native6
        dataset: ERA51
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: psl
        preprocessor: weathertype_preproc
        additional_datasets:
          *datasets_era5

      era5_pr_wt: &era5_pr_wt
        project: native6
        dataset: ERA51
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: pr
        preprocessor: weathertype_preproc_pr
        additional_datasets:
          *datasets_era5    

      eobs_pr_wt: &eobs_pr_wt
        project: OBS
        dataset: E-OBS
        type: ground
        mip: day
        version: v29.0e-0.25
        tier: 2
        start_year: 1958
        end_year: 2014
        short_name: pr
        preprocessor: weathertype_preproc_pr
        additional_datasets:
          *datasets_EOBS

      era5_msl_mean: &era5_msl
        project: native6
        dataset: ERA5
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: psl
        preprocessor: mean_preproc
        additional_datasets:
          *datasets_era5

      era5_tp_mean: &era5_prcp
        project: native6
        dataset: ERA5
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: pr
        preprocessor: mean_preproc
        additional_datasets:
          *datasets_era5
          
      era5_tas_mean: &era5_temp
        project: native6
        dataset: ERA5
        type: reanaly
        frequency: day
        mip: day
        latestversion: v1
        tier: 3
        start_year: 1958
        end_year: 2014
        short_name: tas
        preprocessor: mean_preproc
        additional_datasets:
          *datasets_era5

      cmip6_historical_psl_day_wt: &cmip6_historical_wt
        project: CMIP6
        activity: CMIP
        exp: historical
        mip: day
        short_name: psl
        preprocessor: weathertype_preproc
        start_year: 1950
        end_year: 2014
        additional_datasets:
          *datasets_psl_cmip6
      
      cmip6_historical_psl_day_mean: &cmip6_historical_psl
        project: CMIP6
        activity: CMIP
        exp: historical
        mip: day
        short_name: psl
        preprocessor: mean_preproc
        start_year: 1950
        end_year: 2014
        additional_datasets:
          *datasets_psl_cmip6

      cmip6_historical_prcp_day_mean: &cmip6_historical_prcp
        project: CMIP6
        activity: CMIP
        exp: historical
        mip: day
        short_name: pr
        preprocessor: mean_preproc
        start_year: 1950
        end_year: 2014
        additional_datasets:
          *datasets_psl_cmip6
      
      cmip6_historical_temp_day_mean: &cmip6_historical_ta
        project: CMIP6
        activity: CMIP
        exp: historical
        mip: day
        short_name: tas
        preprocessor: mean_preproc
        start_year: 1950
        end_year: 2014
        additional_datasets:
          *datasets_psl_cmip6

    scripts:
      weathertyping:
        correlation_threshold: 0.9
        rmse_threshold: 0.002
        automatic_slwt: true
        predefined_slwt: {1: [1, 2, 19], 2: [3, 4, 22, 21], 3: [5, 6, 15, 16], 4: [7, 8, 11, 18], 5: [9, 17], 6: [10, 20], 7: [12, 13, 14], 8: [23, 24], 9: [25, 26], 0: [27]}
        plotting: true
        script: ../diag_scripts/weathertyping/weathertyping.py
