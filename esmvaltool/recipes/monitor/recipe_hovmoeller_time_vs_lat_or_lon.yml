# ESMValTool
#
# General instructions:
#
# (1) Copy the configuration file
#     /work/bd1179/esmvaltool_hackathon/config/config-user.yml to
#     $HOME/.esmvaltool/config-user.yml ($HOME is YOUR home directory) and modify
#     the 'output_dir' key (we recommend your scratch directory /scratch/$USER/).
# (2) Copy all diagnostics in /work/bd1179/esmvaltool_hackathon/diag_scripts/
#     to a location of your choice.
# (3) Copy this recipe to a location of your choice.
# (4) Modify the diagnostics paths in this recipe ('script: xxx.py') to point
#     to your copy of the diagnostic scripts (see (2)).
# (5) Run ESMValTool by 'esmvaltool run /path/to/your/copy/of/this/recipe.yml.'
# (6) To re-run a single diagnostic wihtout invoking ESMValTool over and over,
#     look for "To re-run this diagnostic ..." lines in the output log and
#     copy-paste the relevant command to your shell, add a '-f' flag at the end
#     and run it. Remember: if you change the recipe, you NEED to re-run the
#     entire recipe!
#
---
documentation:
  title: ICON Evaluation.
  description: Evaluate ICON simulations with observational products.
  authors:
    - schlund_manuel


preprocessors:

  zonal_mean:  # this is an arbitrary name (used in the 'variables' section below)
    regrid:  # this is a predefined name (see https://docs.esmvaltool.org/projects/ESMValCore/en/latest/recipe/preprocessor.html)
      target_grid: 2x2
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted
    zonal_statistics:
      operator: mean

  meridional_mean:  # this is an arbitrary name (used in the 'variables' section below)
    regrid:  # this is a predefined name (see https://docs.esmvaltool.org/projects/ESMValCore/en/latest/recipe/preprocessor.html)
      target_grid: 2x2
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted
    meridional_statistics:
      operator: mean


diagnostics:

  time_vs_lat_without_ref:  # this is an arbitrary name
    # Should create a single panel with a time vs. latitude contour plot
    variables:
      tas:
        preprocessor: zonal_mean
        mip: Amon
        timerange: '20000101/20030101'
        additional_datasets:
          - {project: ICON, dataset: ICON, exp: icon-2.6.1_atm_amip_R2B5_r1v1i1p1l1f1}
    scripts:
      plot:  # this is an arbitrary name
        script: monitor/multi_datasets.py
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        plots:
          hovmoeller_time_vs_lat_or_lon:
            # common_cbar: true
            # show_x_minor_ticks: true
            # show_y_minor_ticks: true
            # rasterize: true
            plot_func: contourf
            # plot_kwargs:
            #   levels: 20

  time_vs_lat_with_ref:
    variables:
      tas:
        preprocessor: zonal_mean
        mip: Amon
        timerange: '20000101/20030101'
        additional_datasets:
          - {project: ICON,    dataset: ICON, exp: icon-2.6.1_atm_amip_R2B5_r1v1i1p1l1f1}
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, reference_for_monitor_diags: true}
    scripts:
      plot:
        script: monitor/multi_datasets.py
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        plots:
          hovmoeller_time_vs_lat_or_lon:
            common_cbar: true

  time_vs_lon_without_ref:
    variables:
      tas:
        preprocessor: meridional_mean
        mip: Amon
        timerange: '20000101/20030101'
        additional_datasets:
          - {project: ICON,    dataset: ICON, exp: icon-2.6.1_atm_amip_R2B5_r1v1i1p1l1f1}
    scripts:
      plot:
        script: monitor/multi_datasets.py
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        plots:
          hovmoeller_time_vs_lat_or_lon:
            common_cbar: true

  time_vs_lon_with_ref:
    variables:
      tas:
        preprocessor: meridional_mean
        mip: Amon
        timerange: '20000101/20030101'
        additional_datasets:
          - {project: ICON,    dataset: ICON, exp: icon-2.6.1_atm_amip_R2B5_r1v1i1p1l1f1}
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, reference_for_monitor_diags: true}
    scripts:
      plot:
        script: monitor/multi_datasets.py
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        plots:
          hovmoeller_time_vs_lat_or_lon:
            common_cbar: true
