# ESMValTool
---
documentation:
  title: Performance metrics plots.
  description: >
    Compare performance of CMIP simulations to a reference dataset.
  authors:
    - cammarano_diego
    - lindenlaub_lukas
  maintainer:
    - lindenlaub_lukas
  references:
    - eyring21ipcc
    - gleckler08jgr

cmip5: &CMIP5
  project: CMIP5
  ensemble: r1i1p1

datasets:
  # cmip6
  # - {dataset: ACCESS-ESM1-5, institute: CSIRO}
  - {dataset: MPI-ESM1-2-HR}

preprocessors:
  default: &default  # common preprocessor settings
    regrid:
      target_grid: 3x3
      scheme: linear
    distance_metric:
      metric: weighted_rmse
    climate_statistics:
      operator: mean
      period: month
    mask_fillvalues:
      threshold_fraction: 0.95
  # regional preprocessing
  SAH: 
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [SAH]}
    <<: *default
  WCE: 
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [WCE]}
    <<: *default
  MED: 
    extract_shape:
      shapefile: ar6
      method: contains
      ids: {Acronym: [MED]}
    <<: *default

var_default: &var_default
  mip: Amon
  project: CMIP6
  exp: historical
  ensemble: r1i1p1f1
  grid: gn
  start_year: 2000
  end_year: 2002
  split: Ref1  # first triangle

diagnostics:
  portrait_rmse:
    themes: [aerosols, phys, clouds, atmDyn, chem, ghg]
    realms: [atmos, land, atmosChem, ocean]
    variables:
      pr_WCE: &pr
        <<: *var_default
        short_name: pr
        variable: pr
        preprocessor: WCE
        ppregion: WCE
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS6, type: reanaly,
             version: 1, tier: 3, reference_for_metric: true}
      pr_SAH:
        <<: *pr
        ppregion: SAH
        preprocessor: SAH
      pr_MED:
        <<: *pr
        ppregion: MED
        preprocessor: MED

      tas_WCE: &tas
        <<: *var_default
        short_name: tas
        variable: tas
        preprocessor: WCE
        ppregion: WCE
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS6, type: reanaly,
             version: 1, tier: 3, reference_for_metric: true}
      tas_SAH:
        <<: *tas
        ppregion: SAH
        preprocessor: SAH
      tas_MED:
        <<: *tas
        short_name: tas
        ppregion: MED
        preprocessor: MED

    scripts:
      portrait:
        script: portrait_plot.py
        x_by: ppregion  # extra_facet
        y_by: short_name
        group_by: project
        normalize: "centered_median"
        # default_split: Ref1
        nan_color: null
        plot_kwargs:
          vmin: -0.5
          vmax: +0.5
        cbar_kwargs:
          label: Relative RMSE
          extend: both
