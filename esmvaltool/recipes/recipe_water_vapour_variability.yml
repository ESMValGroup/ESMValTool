# ESMValTool
# recipe_water_vapor_variability.yml
---
documentation:

  title: Analysis of water vapor variability in CMIP6 models.

  description: This is a recipe for analysing water vapor variability in CMIP6 models.

  authors:
    - malinina_elizaveta

preprocessors:
  annual_globe: &regrid
    regrid:
      target_grid: 1x1
      scheme: linear
  winter_globe: &winter
    extract_season:
      season: JFM
  spring_globe: &spring
    extract_season:
      season: AMJ
  summer_globe: &summer
    extract_season:
      season: JAS
  fall_globe: &fall
    extract_season:
      season: OND
  winter_regrid:
    <<: *regrid
    <<: *winter
  spring_regrid:
    <<: *regrid
    <<: *spring
  summer_regrid:
    <<: *regrid
    <<: *summer
  fall_regrid: 
    <<: *regrid
    <<: *fall
  annual_tropics: &tropics
    <<: *regrid
    extract_region: 
      start_longitude: -180
      end_longitude: 180
      start_latitude: -30
      end_latitude: 30
  winter_tropics: 
    <<: *tropics
    <<: *winter
  spring_tropics: 
    <<: *tropics
    <<: *spring
  summer_tropics: 
    <<: *tropics
    <<: *summer
  fall_tropics: 
    <<: *tropics
    <<: *fall

datasets:
  - {dataset: CanESM5-1, institute: CCCma, ensemble: "r1i1p(1:2)f1", grid: gn, project: CMIP6}
  - {dataset: CNRM-CM6-1-HR, ensemble: r1i1p1f2, grid: gr, project: CMIP6}
  - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2, grid: gr, project: CMIP6}
  - {dataset: CNRM-ESM2-1, ensemble: r1i1p1f2, grid: gr, project: CMIP6}
  - {dataset: HadGEM3-GC31-LL, ensemble: r1i1p1f3, grid: gn, project: CMIP6}
  - {dataset: HadGEM3-GC31-MM, ensemble: r1i1p1f3, grid: gn, project: CMIP6}
  - {dataset: MIROC6, ensemble: "r(1:3)i1p1f1", grid: gn, project: CMIP6}
  - {dataset: MPI-ESM1-2-LR, ensemble: "r(11:13)i1p1f1", grid: gn, project: CMIP6} # 14 has weird skewness, for now taken out
  - {dataset: MPI-ESM1-2-LR, ensemble: "r(15:30)i1p1f1", grid: gn, project: CMIP6}
  - {dataset: NorESM2-LM, ensemble: r1i1p1f1, grid: gn, project: CMIP6}
  - {dataset: NorESM2-MM, ensemble: r1i1p1f1, grid: gn, project: CMIP6}
  - {dataset: UKESM1-0-LL, ensemble: "r(1:4)i1p1f2", grid: gn, project: CMIP6}
  - {dataset: UKESM1-0-LL, ensemble: "r(8:12)i1p1f2", grid: gn, project: CMIP6}
  - {dataset: UKESM1-0-LL, ensemble: "r(16:19)i1p1f2", grid: gn, project: CMIP6}
  - {dataset: ERA5, project: OBS6, type: reanaly, version: v1, tier: 3}
  # - {dataset: ESACCI-WATERVAPOUR, project: OBS6, type: sat,
  #            version: CDR2_L3C-05deg_fv3.1, tier: 3}
  # - {dataset: CMCC-CM2-SR5, ensemble: r1i1p1f1, grid: gn, project: CMIP6} too small mean
  # - {dataset: CMCC-ESM2, ensemble: r1i1p1f1, grid: gn, project: CMIP6} too small mean
  # # - {dataset: CESM2, ensemble: r4i1p1f1, grid: gn} 1 Jan 2015 problem
  # - {dataset: CESM2, ensemble: "r(10:11)i1p1f1", grid: gn} problem
  # - {dataset: CESM2-WACCM, ensemble: r1i1p1f1, grid: gn} problem

diagnostics:
  prw_trop:
    description: Figure for water vapour variability pdfs
    variables:
      annual:
        short_name: prw
        preprocessor: annual_tropics
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5
      winter:
        short_name: prw
        preprocessor: winter_tropics
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5
      spring:
        short_name: prw
        preprocessor: spring_tropics
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5
      summer:
        short_name: prw
        preprocessor: summer_tropics
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5
      fall:
        short_name: prw
        preprocessor: fall_tropics
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5
    scripts: 
      slopes: 
        script: water_vapour/distribution_moments_slopes.py
        mpl_style: cccma_wv
        time_range: 1980-2022
        region: tropics
      pdfs: 
        script: water_vapour/distribution_moments_pdfs.py
        mpl_style: cccma_wv
        time_range: 1980-2022
        region: tropics
  prw_glob:
    description: Figure for water vapour variability
    variables:
      annual:
        short_name: prw
        preprocessor: annual_globe
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5  
      winter:
        short_name: prw
        preprocessor: winter_regrid
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5  
      spring:
        short_name: prw
        preprocessor: spring_regrid
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5  
      summer:
        short_name: prw
        preprocessor: summer_regrid
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5  
      fall:
        short_name: prw
        preprocessor: fall_regrid
        exp: [historical, ssp126]
        start_year: 1980
        end_year: 2022
        mip: Eday
        reference_dataset: ERA5  
    scripts: 
      maps:
        script: water_vapour/distribution_moments_maps.py 
        mpl_style: cccma_wv
        time_range: 1980-2022
      scatter: 
        script: water_vapour/distribution_moments_scatter.py
        mpl_style: cccma_wv
        time_range: 1980-2022