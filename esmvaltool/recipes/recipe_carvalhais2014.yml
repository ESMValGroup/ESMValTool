# ESMValTool
# recipe_carvalhais2014.yml
---
documentation:
  description: |
    Recipe to calculate the ecosystem turnover time of carbon based on Carvalhais et al., 2014, Nature

  authors:
    - koirala_sujan

  maintainer:
    - koirala_sujan

  references:
    - carvalhais2014

  projects:
    - crescendo


datasets:

  - {dataset: HadGEM2-ES, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}
  - {dataset: MIROC-ESM, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}
  - {dataset: IPSL-CM5A-MR, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}
  - {dataset: NorESM1-M, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}
  - {dataset: MPI-ESM-LR, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}
  # - {dataset: inmcm4, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}
##  - {dataset: bcc-csm1-1, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}
  # - {dataset: CanESM2, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}
  - {dataset: CCSM4, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}
  - {dataset: GFDL-ESM2G, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1985, end_year: 2005}

# TODO: All multi-model statistics are turned off until the preprocessor order is fixed.

preprocessors:
  # --------------------------------------------------
  # Time series preprocessors
  # --------------------------------------------------
  preproc_turnover:
    custom_order: true
    climate_statistics:
      operator: mean
      period: full
    regrid: 
      target_grid: 0.5x0.5
      scheme: nearest
    mask_landsea:
      mask_out: sea
    multi_model_statistics:
      span: full
      statistics: [median]
  preproc_regrid:
    regrid: 
      target_grid: 0.5x0.5
      scheme: nearest
    mask_landsea:
      mask_out: sea
diagnostics:
  # --------------------------------------------------
  # Time series diagnostics
  # --------------------------------------------------

  diag_calc_turnover:
    description: calculate turnover time of carbon
    variables:
      gpp: # Gross primary productivity
        preprocessor: preproc_turnover
        fx_files: [areacella]
        mip: Lmon
      ctotal: # total carbon stock
        preprocessor: preproc_turnover
        derive: true
        mip: Lmon
      pr: # mean precipitation
        preprocessor: preproc_turnover
        mip: Amon
      tas: #mean air temperature
        preprocessor: preproc_turnover
        mip: Amon
    scripts:
      zonal_Tau:
        script: land_carbon_cycle/diag_zonal_turnover.py
        ancestors: [ctotal, gpp]
        obs_files: ['zonal_mean_tau_ctotal_Carvalhais.nc']
        obs_variables: ['tau_ctotal','tau_ctotal_5','tau_ctotal_95']
      global_Tau:
        script: land_carbon_cycle/diag_global_turnover.py
        ancestors: [ctotal, gpp]
        obs_files: ['tau_ctotal_Carvalhais.nc']
        obs_variables: ['tau_ctotal','tau_ctotal_5','tau_ctotal_95']
      zonal_correlation:
        script: land_carbon_cycle/diag_zonal_correlation.py
        ancestors: [ctotal, gpp,pr, tas]
        obs_files: ['zonal_correlation_tau_ctotal_pr_Carvalhais.nc','zonal_correlation_tau_ctotal_tas_Carvalhais.nc']
        obs_variables: ['r_tau_ctotal_pr','r_tau_ctotal_pr_5','r_tau_ctotal_pr_95','r_tau_ctotal_tas','r_tau_ctotal_tas_5','r_tau_ctotal_tas_95']
        