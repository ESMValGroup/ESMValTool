# ESMValTool
# 
---
documentation:
  description: ENSO CLIVAR metrics - basic ENSO characteristics
  title: Reproducing basic ENSO characteristics metrics by Yann Planton
  authors:
    - chun_felicity
    # - sullivan_arnold
  maintainer:
    - chun_felicity

datasets:
  - {dataset: ACCESS-ESM1-5, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: ACCESS-CM2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: BCC-CSM2-MR, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: BCC-ESM1, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
# There were errors in variable areacello:
#  There are multiple coordinates with standard_name "latitude": ['lat', 'latitude']
#  There are multiple coordinates with standard_name "longitude": ['lon', 'longitude']

  # - {dataset: AWI-CM-1-1-MR, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
# extract region bounds error - ValueError: expected 0 or 2 bound values per cell ? unstructured
  # - {dataset: AWI-ESM-1-1-LR, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: CAS-ESM2-0, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: CESM2-FV2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: CESM2-WACCM-FV2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: CESM2-WACCM, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: CESM2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: CMCC-CM2-HR4, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: CMCC-CM2-SR5, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: CMCC-ESM2, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: CanESM5, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: FGOALS-g3, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: FIO-ESM-2-0, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: GISS-E2-1-G-CC, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
# dimensions
# 'https://furtherinfo.es-doc.org/CMIP6.NASA-GISS.GISS-E2-1-G-CC.historic ...' grid -'atmospheric grid: 144x90, ocean grid: 288x180'
  # - {dataset: GISS-E2-1-G, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: GISS-E2-1-H, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: IITM-ESM, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1900, end_year: 2014} # searching esgf, changed year
#   WARNING [570089] Using 'area_weighted' regridder scheme in Omon variables for dataset IITM-ESM causes discontinuities in the longitude coordinate.
# ERROR   [570089] Supplementary variables are needed to calculate grid cell areas for irregular or unstructured grid of cube sea_surface_temperature / (degC)    (time: 1380; cell index along second dimension: 24; cell index along first dimension: 50)
# ERROR   [570089] Failed to run preprocessor function 'area_statistics' on the data

  - {dataset: MCM-UA-1-0, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: MIROC6, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: MPI-ESM-1-2-HAM, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: MPI-ESM1-2-HR, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: MPI-ESM1-2-LR, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: MRI-ESM2-0, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  # - {dataset: NESM3, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
# missing cell area
  - {dataset: NorCPM1, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: NorESM2-LM, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: NorESM2-MM, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: SAM0-UNICON, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}
  - {dataset: TaiESM1, project: CMIP6, exp: historical, ensemble: r1i1p1f1, grid: gn, start_year: 1850, end_year: 2014}

  # observations
  # - {dataset: HadISST, project: OBS, type: reanaly, tier: 2, mip: Omon}
  - {dataset: TROPFLUX, project: OBS6, type: reanaly, tier: 2, mip: Omon}
  
preprocessors:
  ssta_enso: &base_enso #pattern, lifecycle w/o month, duration, diversity
    custom_order: true
    convert_units:
      units: degC
    regrid:
      target_grid: 1x1 
      scheme: linear
    extract_region: &nino34
      start_longitude: 190.
      end_longitude: 240.
      start_latitude: -5.
      end_latitude: 5.
    rolling_window_statistics: #twice
      coordinate: time
      operator: mean
      window_length: 5
    anomalies:
      period: monthly

  ssta_ninoarea: ##lifecycle duration
    <<: *base_enso
    area_statistics:
      operator: mean

  ssta_meridional: #diversity more smoothing, lifecycle duration
    <<: *base_enso
    extract_region: &eqp #lifecycle 160 280
      start_longitude: 150.
      end_longitude: 270.
      start_latitude: -5.
      end_latitude: 5.
    meridional_statistics:
      operator: mean

  enso_seas_asym: #boreal season in script, climate stddev
    custom_order: true
    extract_region: 
      <<: *nino34
    convert_units:
      units: degC
    anomalies:
      period: monthly
    area_statistics:
      operator: mean


diagnostics:
  diagnostic_metrics:
    description: run preprocessors on variables for ENSO metrics
    variables:
      tos_seas_asym: #seasonality and asymmetry
        short_name: tos
        mip: Omon
        preprocessor: enso_seas_asym
      tos_lifdur1: # lifecycle duration pt1
        short_name: tos
        mip: Omon
        preprocessor: ssta_ninoarea
      tos_lifdurdiv2: # pt2 diversity lifecycle duration
        short_name: tos
        mip: Omon
        preprocessor: ssta_meridional
    scripts:
      plot_script:
        script: enso_metrics/enso_diag1metrics.py

  diag_collect:
    description: collect metrics
    variables:
      tos: #dummy variable to fill recipe requirements
        mip: Omon
    scripts:
      matrix_collect:
        script: enso_metrics/matrix.py
        # above diagnostic name and script name
        diag_metrics: diagnostic_metrics/plot_script #cfg['work_dir']

