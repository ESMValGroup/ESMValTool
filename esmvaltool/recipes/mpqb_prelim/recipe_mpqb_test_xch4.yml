# ESMValTool
# recipe_mpqb_xch4.yml
---
documentation:
  title: Methane evaluation with ESA CMUG data
  description: |
    Recipe for the comparison of ESA XCH4 data with CMIP6 models

  authors:
    - hassler_birgit
    - mueller_benjamin


################################################
# Define some default parameters using anchors #
################################################

nh_region: &nh_region
  extract_region:
    start_longitude: 0
    end_longitude: 360
    start_latitude: 30
    end_latitude: 90
    
sh_region: &sh_region
  extract_region:
    start_longitude: 0
    end_longitude: 360
    start_latitude: -90
    end_latitude: -30

mmm_stat_obs: &mmm_stat_obs
  multi_model_statistics:
    span: overlap
    statistics: [mean]
    exclude: [ERA5-Land, ERA5, ERA-Interim, JRA-55]

mpqbregridder: &mpqbregridder
  regrid:
    #target_grid: 2.5x2.5
    target_grid: 5x5
    scheme: area_weighted
  <<: *nh_region
  <<: *nh_region
  monthly_statistics:
    operator: mean
 
mpqbregridder_sh: &mpqbregridder_sh
  regrid:
    #target_grid: 2.5x2.5
    target_grid: 5x5
    scheme: area_weighted
  <<: *sh_region
  monthly_statistics:
    operator: mean
 
mpqbregridder_nh: &mpqbregridder_nh
  regrid:
    #target_grid: 2.5x2.5
    target_grid: 5x5
    scheme: area_weighted
  <<: *nh_region
  monthly_statistics:
    operator: mean
 
    
# The main preprocessor for all
# input data
# default_pp_maps: &pp_maps
  # custom_order: true
  # mask_below_threshold:
    # threshold: 0.0000000001
  # <<: *mpqbregridder
  # mask_landsea:
    # mask_out: sea
  # <<: *mmm_stat_obs

# default_pp_maps_nomask: &pp_maps_nomask
  # custom_order: true
  # mask_below_threshold:
    # threshold: 0.0000000001
  # <<: *mpqbregridder  
  # <<: *mmm_stat_obs
 
# default_pp_maps_withnoth: &pp_maps_with_nothing
  # custom_order: true
  # mask_below_threshold:
    # threshold: 0.0000000001
  
  
default_pp_maps_without_gl: &pp_maps_without_gl
  custom_order: true
  <<: *mpqbregridder
  mask_multimodel:   

default_pp_maps_with_gl: &pp_maps_with_gl
  custom_order: true
  mask_below_threshold:
    threshold: 0.0000000001
  #mask_fillvalues:
    #threshold_fraction: 0.0     
    #min_value: -1e20
  <<: *mpqbregridder
  <<: *mmm_stat_obs

default_pp_maps_without_sh: &pp_maps_without_sh
  custom_order: true
  <<: *mpqbregridder_sh
  mask_multimodel:
    
default_pp_maps_without_nh: &pp_maps_without_nh
  custom_order: true
  <<: *mpqbregridder_nh
  mask_multimodel:
       
# default_pp_maps_without_samonsoon: &pp_maps_without_samonsoon
  # custom_order: true
  # mask_below_threshold:
    # threshold: 0.0000000001
  # # mask_multimodel:    
  # <<: *mpqbregridder
  # <<: *extr_samonsoon


# default_pp_maps_with_samonsoon: &pp_maps_with_samonsoon
  # custom_order: true
  # mask_below_threshold:
    # threshold: 0.0000000001
  # <<: *mpqbregridder
  # <<: *extr_samonsoon
  # mask_landsea:
    # mask_out: sea
  # <<: *mmm_stat_obs
  
  
# default_pp_maps_without_europe: &pp_maps_without_europe
  # custom_order: true
  # mask_below_threshold:
    # threshold: 0.0000000001
  # # mask_multimodel:    
  # <<: *mpqbregridder
  # <<: *extr_europe
 
# default_pp_maps_without_northamerica: &pp_maps_without_northamerica
  # custom_order: true
  # mask_below_threshold:
    # threshold: 0.0000000001
  # # mask_multimodel:    
  # <<: *mpqbregridder
  # <<: *extr_northamerica
    
# Additional preprocessor for
# line plots
default_pp_line: &pp_line
  mask_fillvalues:
    #threshold_fraction: 0.1
    threshold_fraction: 0.0
  area_statistics:
    operator: mean


# Datasets
################################################

datasets:
  # - {dataset: CDS-XCH4, project: OBS, type: sat, version: L3, tier: 3, 
     # derive: false, alias: CDS-XCH4}
#####################
  # - {dataset: BCC-CSM2-MR, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     # exp: esm-hist, derive: true, alias: BCC-CSM2-MR}
  # - {dataset: CNRM-ESM2-1, project: CMIP6, ensemble: r1i1p1f2, grid: gr,
     # exp: esm-hist, derive: true, alias: CNRM-ESM2-1}
  # - {dataset: UKESM1-0-LL, project: CMIP6, ensemble: r1i1p1f2, grid: gn,
     # exp: esm-hist, derive: true, alias: UKESM1-0-LL}
#####################     
  - {dataset: BCC-CSM2-MR, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     exp: historical, derive: true, alias: BCC-CSM2-MR}
  - {dataset: CNRM-ESM2-1, project: CMIP6, ensemble: r1i1p1f2, grid: gr,
     exp: historical, derive: true, alias: CNRM-ESM2-1}
  - {dataset: UKESM1-0-LL, project: CMIP6, ensemble: r1i1p1f2, grid: gn,
     exp: historical, derive: true, alias: UKESM1-0-LL}
  - {dataset: BCC-ESM1, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     exp: historical, derive: true, alias: BCC-ESM1}
  # - {dataset: MRI-ESM2-0, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     # exp: historical, derive: true, alias: MRI-ESM2-0}
  - {dataset: CESM2-WACCM, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     exp: historical, derive: true, alias: CESM2-WACCM}
  - {dataset: CESM2-WACCM-FV2, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     exp: historical, derive: true, alias: CESM2-WACCM-FV2}
  - {dataset: GFDL-ESM4, project: CMIP6, ensemble: r1i1p1f1, grid: gr1, 
     exp: historical, derive: true, alias: GFDL-ESM4}   
######################
  # - {dataset: BCC-CSM2-MR, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     # exp: ssp585, derive: true, alias: BCC-CSM2-MR}
  # - {dataset: CNRM-ESM2-1, project: CMIP6, ensemble: r1i1p1f2, grid: gr,
     # exp: ssp585, derive: true, alias: CNRM-ESM2-1}
  # - {dataset: UKESM1-0-LL, project: CMIP6, ensemble: r1i1p1f2, grid: gn,
     # exp: ssp585, derive: true, alias: UKESM1-0-LL}
  # # - {dataset: MRI-ESM2-0, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     # # exp: ssp585, derive: true, alias: MRI-ESM2-0}
  # - {dataset: CESM2-WACCM, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     # exp: ssp585, derive: true, alias: CESM2-WACCM}
  # - {dataset: GFDL-ESM4, project: CMIP6, ensemble: r1i1p1f1, grid: gr1, 
     # exp: ssp585, derive: true, alias: GFDL-ESM4}   
######################
  # - {dataset: BCC-CSM2-MR, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     # exp: ssp245, derive: true, alias: BCC-CSM2-MR}
  # - {dataset: CNRM-ESM2-1, project: CMIP6, ensemble: r1i1p1f2, grid: gr,
     # exp: ssp245, derive: true, alias: CNRM-ESM2-1}
  # - {dataset: UKESM1-0-LL, project: CMIP6, ensemble: r1i1p1f2, grid: gn,
     # exp: ssp245, derive: true, alias: UKESM1-0-LL}
  # # - {dataset: MRI-ESM2-0, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     # # exp: ssp245, derive: true, alias: MRI-ESM2-0}
  # - {dataset: CESM2-WACCM, project: CMIP6, ensemble: r1i1p1f1, grid: gn, 
     # exp: ssp245, derive: true, alias: CESM2-WACCM}
  # - {dataset: GFDL-ESM4, project: CMIP6, ensemble: r1i1p1f1, grid: gr1, 
     # exp: ssp245, derive: true, alias: GFDL-ESM4}   
######################
  # - {dataset: BNU-ESM, project: CMIP5, ensemble: r1i1p1, 
     # exp: esmHistorical, derive: true, alias: BNU-ESM}
  # - {dataset: FIO-ESM, project: CMIP5, ensemble: r1i1p1, 
     # exp: esmHistorical, derive: true, alias: FIO-ESM}
  # - {dataset: MRI-ESM1, project: CMIP5, ensemble: r1i1p1, 
     # exp: esmHistorical, derive: true, alias: MRI-ESM1}
 
preprocessors:
  pp_maps_annual:
    annual_statistics:
      operator: mean
    convert_units:
      units: ppbv

  # pp_mpqb_xch4:
    # <<: *pp_maps    

  # pp_mpqb_xch4_nomask:
    # <<: *pp_maps_nomask    

  # pp_mpqb_xch4_withnoth:
    # <<: *pp_maps_with_nothing   
    
  pp_mpqb_xch4_without_gl:
    <<: *pp_maps_without_gl    

  pp_mpqb_xch4_without_sh:
    <<: *pp_maps_without_sh    

  pp_mpqb_xch4_without_nh:
    <<: *pp_maps_without_nh    

  pp_mpqb_xch4_with_gl:
    <<: *pp_maps_with_gl      
    
  # pp_mpqb_xch4_without_samonsoon:
    # <<: *pp_maps_without_samonsoon    

  # pp_mpqb_xch4_with_samonsoon:
    # <<: *pp_maps_with_samonsoon    

  # pp_mpqb_xch4_without_europe:
    # <<: *pp_maps_without_europe    

  # pp_mpqb_xch4_without_northamerica:
    # <<: *pp_maps_without_northamerica    
    
    
  # pp_mpqb_xch4_std:
    # anomalies:
      # period: monthly
# #      standardize: true
    # <<: *pp_maps

  pp_lineplots_without_gl:
    custom_order: true
    convert_units:
      units: ppbv    
    <<: *pp_maps_without_gl
    <<: *pp_line

  pp_lineplots_without_nh:
    custom_order: true
    convert_units:
      units: ppbv    
    <<: *pp_maps_without_nh
    <<: *pp_line

  pp_lineplots_without_sh:
    custom_order: true
    convert_units:
      units: ppbv    
    <<: *pp_maps_without_sh
    <<: *pp_line

  pp_lineplots_with_gl:
    custom_order: true
    convert_units:
      units: ppbv    
    <<: *pp_maps_with_gl
    <<: *pp_line
    
  # pp_lineplots_without_samonsoon:
    # custom_order: true
    # convert_units:
      # units: ppbv    
    # <<: *pp_maps_without_samonsoon
    # <<: *pp_line
    
  # pp_lineplots_with_samonsoon:
    # <<: *pp_maps_with_samonsoon
    # <<: *pp_line

  # pp_lineplots_without_europe:
    # custom_order: true
    # convert_units:
      # units: ppbv    
    # <<: *pp_maps_without_europe
    # <<: *pp_line

  # pp_lineplots_without_northamerica:
    # custom_order: true
    # convert_units:
      # units: ppbv    
    # <<: *pp_maps_without_northamerica
    # <<: *pp_line    
    
  # pp_lineplots_anncyc_without_europe:
    # custom_order: true
    # convert_units:
      # units: ppbv    
    # <<: *pp_maps_without_europe
    # <<: *pp_line
    # climate_statistics:
      # operator: mean
      # period: month

  # pp_lineplots_anncyc_without_northamerica:
    # custom_order: true
    # convert_units:
      # units: ppbv    
    # <<: *pp_maps_without_northamerica
    # <<: *pp_line
    # climate_statistics:
      # operator: mean
      # period: month 
      
  # pp_lineplots_anncyc_without_samonsoon:
    # custom_order: true
    # convert_units:
      # units: ppbv    
    # <<: *pp_maps_without_samonsoon
    # <<: *pp_line
    # climate_statistics:
      # operator: mean
      # period: month

  pp_lineplots_anncyc_without_gl:
    custom_order: true
    convert_units:
      units: ppbv    
    <<: *pp_maps_without_gl
    <<: *pp_line
    climate_statistics:
      operator: mean
      period: month

  pp_lineplots_anncyc_without_nh:
    custom_order: true
    convert_units:
      units: ppbv    
    <<: *pp_maps_without_nh
    <<: *pp_line
    climate_statistics:
      operator: mean
      period: month

  pp_lineplots_anncyc_without_sh:
    custom_order: true
    convert_units:
      units: ppbv    
    <<: *pp_maps_without_sh
    <<: *pp_line
    climate_statistics:
      operator: mean
      period: month
    
  # pp_lineplots_std:
    # anomalies:
      # period: monthly
      # standardize: true
    # <<: *pp_maps
    # <<: *pp_line

  # pp_lineplots_gl_std:
    # anomalies:
      # period: monthly
      # standardize: true
    # <<: *pp_maps_without_gl
    # <<: *pp_line

  # pp_lineplots_without_trop_std:
    # anomalies:
      # period: monthly
      # standardize: true
    # # mask_above_threshold:  # This is needed to mask out regions where std=0
      # # threshold: 100
    # # mask_below_threshold:
      # # threshold: -100
    # <<: *pp_maps_without_trop
    # <<: *pp_line
    
  # pp_lineplots_without_europe_std:
    # anomalies:
      # period: monthly
      # standardize: true
    # <<: *pp_maps_without_europe
    # <<: *pp_line

  # pp_lineplots_without_northamerica_std:
    # anomalies:
      # period: monthly
      # standardize: true
    # <<: *pp_maps_without_northamerica
    # <<: *pp_line
    
xch4_def: &xch4def
  mip: Amon
  start_year: 2003
  end_year: 2014
  #end_year: 2005

xch4_def_future: &xch4def_fut
  mip: Amon
  start_year: 2016
  end_year: 2099
  
  
diagnostics:
  lineplots_without_gl:
    description: lineplots
    variables:
      xch4:
        preprocessor: pp_lineplots_without_gl
        <<: *xch4def
    scripts:
      lineplot_gl:
        script: mpqb/mpqb_lineplot.py
  lineplots_anncyc_without_gl:
    description: lineplots
    variables:
      xch4:
        preprocessor: pp_lineplots_anncyc_without_gl
        derive: true
        <<: *xch4def
    scripts:
      lineplot_gl_anncyc:
        script: mpqb/mpqb_lineplot_anncyc.py
  lineplots_without_nh:
    description: lineplots
    variables:
      xch4:
        preprocessor: pp_lineplots_without_nh
        <<: *xch4def
    scripts:
      lineplot_gl:
        script: mpqb/mpqb_lineplot.py
  lineplots_anncyc_without_nh:
    description: lineplots
    variables:
      xch4:
        preprocessor: pp_lineplots_anncyc_without_nh
        derive: true
        <<: *xch4def
    scripts:
      lineplot_gl_anncyc:
        script: mpqb/mpqb_lineplot_anncyc.py
  lineplots_without_sh:
    description: lineplots
    variables:
      xch4:
        preprocessor: pp_lineplots_without_sh
        <<: *xch4def
    scripts:
      lineplot_gl:
        script: mpqb/mpqb_lineplot.py
  lineplots_anncyc_without_sh:
    description: lineplots
    variables:
      xch4:
        preprocessor: pp_lineplots_anncyc_without_sh
        derive: true
        <<: *xch4def
    scripts:
      lineplot_gl_anncyc:
        script: mpqb/mpqb_lineplot_anncyc.py
