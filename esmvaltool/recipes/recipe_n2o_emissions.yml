# ESMValTool
# recipe_n2o_emissions.yml
---
documentation:
  description: |
    perform a 2D map of a variable
    after "cdo remapdis" regridding to regular lat/lon grid
    with temporal mean on period defined by (start, end)
    and vertical mean defined by (zmin, zmax) if var is 3D 

  authors:
    - righi_mattia

  title: |
    Example recipe for running a user-written diagnostic, without installing
    ESMValTool as developer.

datasets:
  - {dataset: CNRM-ESM2-1, project: custom, activity: OMIP, exp: omip1, mip: HOMOImon,
    ensemble: r1i1p1f2, grid: gn, institute: CNRM-CERFACS, frequency: mon, timerange: "1958/2009"}
  - {dataset: CNRM-ESM2-1, project: custom, activity: CMIP, exp: historical, mip: HOMOImon,
    ensemble: r1i1p1f2, grid: gn, institute: CNRM-CERFACS, frequency: mon, timerange: "1958/2009"}
  - {dataset: Yang2020, project: OBS, type: ocnBgchem, version: 1, tier: 2, mip: HOMOImon, frequency: mon}

preprocessors:
  regrid_and_mean_processor: &regrid_and_mean
    # Compute mean before regridding for performance
    custom_order: true
    climate_statistics:
      operator: mean
      period: full
    regrid:
      target_grid: 1x1
      scheme: linear
  prep_n2oflx:
    <<: *regrid_and_mean
    convert_units:
      units: "pmol m-2 s-1"

diagnostics:
  diff_Dpn2o:
    description: "..."

    variables:
      Dpn2o:
        preprocessor: regrid_and_mean_processor

    scripts:
      Dpn2o_plot:
        script: n2o_emissions/n2o_diff_plot.py
        reference_dataset: Yang2020
        data_plot:
          plot_type: contourf
          cmap: wbor
          vmin: -7.0
          vmax: 140.0
          levs: 22
        diff_plot:
          plot_type: contourf
          cmap: GMT_polar
          vmin: -70.0
          vmax: 70.0
          levs: 21

  diff_N2Oflx:
    description: "..."

    variables:
      N2Oflx:
        preprocessor: prep_n2oflx

    scripts:
      N2O_plot:
        script: n2o_emissions/n2o_diff_plot.py
        reference_dataset: Yang2020
        data_plot:
          plot_type: contourf
          cmap: wbor
          vmin: -10
          vmax: 200
          levs: 22
        diff_plot:
          plot_type: contourf
          cmap: GMT_polar
          vmin: -100
          vmax: 100
          levs: 21
