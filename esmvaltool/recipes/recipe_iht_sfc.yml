# (C) Crown Copyright 2023, the Met Office.
# ESMValTool
# recipe_ocean_transport.yml
---
documentation:
  title: Recipe to estimate implied ocean heat transport.

  description: |
    This recipe solves the spherical Poisson equation for the net surface flux (NSF)
    over the ocean to produce an estimate of the implied heat transport within the
    ocean.

    Requires a 'mask' (iris compatible) data cube which identifies the position of the
    land-sea boundaries.
    - Ocean = 0
    - Land = 1

    A caveat of this recipe is that the pattern of ocean heat content (OHC) is not
    considered. Instead the OHC term is assumed to have no spatial variability and the
    storage term is taken to be the global-mean of the NSF.

    The 'single_model' script focuses on a single simulation and produces three plots.
    1. A comparison of the merdional heat transport (MHT) in the global ocean, and the
    pacific, indian and atlantic ocean basins.
    2. The scalar p-field output from the Poisson solver which is used to the estimate
    the heat transport, with arrows overlaid showing the direction of transport.
    3. A plot showing the scalar p-field compared to the input NSF field.
    If multiple datasets are chosen, the plots will be produced for each dataset.

    The 'multi_model' script compares the chosen models to the observational data
    for the same time period. 6 plots are produced in total regardless of the number
    of datasets chosen. Requires an input of the observational data for the chosen time
    period in an iris compatible format, and the name of the dataset.

  authors:
    - pearce_francesca
    - bodas-salcedo_alejandro

  maintainer:
    - bodas-salcedo_alejandro

  references:
    - pearce23jclim

datasets:
  - {dataset: HadGEM3-GC31-LL, project: CMIP6, exp: amip, ensemble: r1i1p1f3, grid: gn, mip: Amon, start_year: 2000, end_year: 2005}
#  - {dataset: BCC-ESM1, project: CMIP6, exp: amip, ensemble: r1i1p1f1, grid: gn, mip: Amon}
#  - {dataset: FGOALS-g3, project: CMIP6, exp: amip, ensemble: r1i1p1f1, grid: gn, mip: Amon}
#  - {dataset: IITM-ESM, project: CMIP6, exp: amip, ensemble: r1i1p1f1, grid: gn, mip: Amon}
#  - {dataset: ACCESS-ESM1-5, project: CMIP6, exp: amip, ensemble: r1i1p1f1, grid: gn, mip: Amon}
#  - {dataset: ACCESS-CM2, project: CMIP6, exp: amip, ensemble: r1i1p1f1, grid: gn, mip: Amon}
#  - {dataset: MIROC6, project: CMIP6, exp: amip, ensemble: r1i1p1f1, grid: gn, mip: Amon}


preprocessors:

  climate_mean:
    climate_statistics:
      operator: mean

diagnostics:

  ocean_heat_transport:
    title: Ocean implied heat transports
    description: Ocean energy flux potential and implied heat transport.
    themes:
      - phys
    realms:
      - atmos
    variables:
      rlds:
        short_name: rlds
        mip: Amon
        preprocessor: climate_mean
      rlus:
        short_name: rlus
        mip: Amon
        preprocessor: climate_mean
      rsds:
        short_name: rsds
        mip: Amon
        preprocessor: climate_mean
      rsus:
        short_name: rsus
        mip: Amon
        preprocessor: climate_mean
      hfls:
        short_name: hfls
        mip: Amon
        preprocessor: climate_mean
      hfss:
        short_name: hfss
        mip: Amon
        preprocessor: climate_mean
    scripts:
      single_model:
        script: iht_sfc/single_model_oht_diag.py
        mask: '/home/h06/hadac/datadir/esmvaltool_data/landmask.nc'
      #multi_model:
      #  script: /data/users/fpearce/git_work/ESMValTool/esmvaltool/implied_heat_transport/multi_model_oht_diag.py
      #  mask: '/net/data/users/fpearce/ocean_poisson/landmask.nc'
      #  obs_data: '/net/data/users/fpearce/ocean_poisson/deepc_2001_2014.nc'
      #  obs_name: 'DEEP-C'
