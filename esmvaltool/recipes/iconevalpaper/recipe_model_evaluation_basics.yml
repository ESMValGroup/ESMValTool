# ESMValTool
---
documentation:
  title: Basic Model Evaluation.
  description: >
    Show plots of several variables that can be used for basic model
    evaluations ("sanity checks").
  authors:
    - hassler_birgit
    - lauer_axel
    - bonnet_pauline
    - schlund_manuel
  maintainer:
    - hassler_birgit


datasets:
- supplementary_variables:
  - short_name: areacella
    skip: true
  - short_name: areacello
    skip: true
  - short_name: sftlf
    skip: true
  - short_name: sftof
    skip: true
  dataset: ICON-XPP
  exp: tvp1802_001
  project: ICON
  start_year: 1995
  end_year: 2014
  component: atm


# Note: for some observational datasets, we use preset time ranges due to
# their limited temporal availability
timerange_for_models: &time_period
  timerange: '1995/2014'


preprocessors:

  timeseries_regular: &pp_timeseries_regular
    regrid:
      target_grid: 1x1
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted
    area_statistics:
      operator: mean

  timeseries_regular_ann:
    <<: *pp_timeseries_regular
    annual_statistics:
      operator: mean

  timeseries_regular_pr:
    <<: *pp_timeseries_regular
    convert_units:
      units: mm day-1

  full_climatology: &pp_full_climatology
    climate_statistics:
      period: full
    regrid:
      target_grid: 1x1
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted

  full_climatology_pr:
    <<: *pp_full_climatology
    convert_units:
      units: mm day-1

  zonal_mean:
    custom_order: true  # makes preprocessor much faster since input for extract_levels is smaller
    climate_statistics:
      period: full
    extract_levels:
      levels: {cmor_table: CMIP6, coordinate: plev19}
      scheme: linear
      coordinate: air_pressure
    regrid:
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted
      target_grid: 1x1
    zonal_statistics:
      operator: mean


diagnostics:

  # Climatologies - maps (full climatology)

  plot_maps_with_references_tas:
    description: Plot climatology maps including reference datasets for tas.
    variables:
      tas:
        <<: *time_period
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: full_climatology
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, reference_for_monitor_diags: true}
    scripts:
      plot:
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        script: monitor/multi_datasets.py
        plots:
          map:
            common_cbar: true
            fontsize: 7
            plot_kwargs:
              default:
                levels: [240, 245, 250, 255, 260, 265, 270, 275, 280, 285, 290, 295, 300, 305, 310]
                extend: 'both'
                aspect: 30
            cbar_kwargs:
              orientation: horizontal
            cbar_kwargs_bias:
              ticks: [-5, -4, -3, -2, -1, -0.5, 0.5, 1, 2, 3, 4, 5]
            plot_kwargs_bias:
              cmap: bwr
              levels: [-5, -4, -3, -2, -1, -0.5, 0.5, 1, 2, 3, 4, 5]
              extend: 'both'
              aspect: 30

  plot_maps_with_references_pr:
    description: Plot climatology maps including reference datasets for pr.
    variables:
      pr:
        <<: *time_period
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: full_climatology_pr
        additional_datasets:
          - {project: OBS, dataset: GPCP-SG, type: atmos, version: 2.3, tier: 2, reference_for_monitor_diags: true}
    scripts:
      plot:
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        script: monitor/multi_datasets.py
        plots:
          map:
            common_cbar: true
            fontsize: 7
            plot_kwargs:
              default:
                levels: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
                cmap: Blues
                extend: 'max'
                aspect: 30
            cbar_kwargs:
              orientation: horizontal
            plot_kwargs_bias:
              cmap: bwr
              levels: [-4, -3, -2, -1, -0.5, 0.5, 1, 2, 3, 4]
              extend: 'both'
              aspect: 30

  # Climatologies (zonal means)

  plot_zonal_mean_profiles_with_references_ta:
    description: Plot 2D zonal mean profiles including reference datasets.
    variables:
      ta:
        <<: *time_period
        var_type: atm_3d_ml
        mip: Amon
        preprocessor: zonal_mean
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, reference_for_monitor_diags: true}
    scripts:
      plot:
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        script: monitor/multi_datasets.py
        plots:
          zonal_mean_profile:
            common_cbar: true
            plot_kwargs:
              default:
                extend: 'both'
                aspect: 30
            plot_kwargs_bias:
              cmap: bwr
              levels: [-5, -4, -3, -2, -1, 1, 2, 3, 4, 5]
              extend: 'both'
              aspect: 30

  plot_zonal_mean_profiles_with_references_ua:
    description: Plot 2D zonal mean profiles including reference datasets.
    variables:
      ua:
        <<: *time_period
        var_type: atm_3d_ml
        mip: Amon
        preprocessor: zonal_mean
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, reference_for_monitor_diags: true}
    scripts:
      plot:
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        script: monitor/multi_datasets.py
        plots:
          zonal_mean_profile:
            common_cbar: true
            plot_kwargs:
              default:
                cmap: Blues

  plot_zonal_mean_profiles_with_references_hus:
    description: Plot 2D zonal mean profiles including reference datasets.
    variables:
      hus:
        <<: *time_period
        mip: Amon
        var_type: atm_3d_ml
        preprocessor: zonal_mean
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, reference_for_monitor_diags: true}
    scripts:
      plot:
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        script: monitor/multi_datasets.py
        plots:
          zonal_mean_profile:
            common_cbar: true
            plot_kwargs:
              default:
                cmap: Blues

  # Time series of global averages (monthly)

  plot_multiple_timeseries:
    description: Plot time series including reference datasets.
    variables:
      tas:
        <<: *time_period
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: timeseries_regular
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, reference_for_monitor_diags: true}
      clt:
        <<: *time_period
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: timeseries_regular
        additional_datasets:
          - {project: OBS, dataset: ESACCI-CLOUD, type: sat, version: AVHRR-AMPM-fv3.0, tier: 2, reference_for_monitor_diags: true}
      rsut:
        <<: *time_period
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: timeseries_regular
        additional_datasets:
          - {project: OBS, dataset: CERES-EBAF, type: sat, version: Ed4.1, tier: 2, reference_for_monitor_diags: true, start_year: 2001, end_year: 2020}
      rlut:
        <<: *time_period
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: timeseries_regular
        additional_datasets:
          - {project: OBS, dataset: CERES-EBAF, type: sat, version: Ed4.1, tier: 2, reference_for_monitor_diags: true, start_year: 2001, end_year: 2020}
      rtnt:
        derive: true
        force_derivation: true
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: timeseries_regular_ann
        timerange: '1995/2014'
      prw:
        <<: *time_period
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: timeseries_regular
        # timerange MUST NOT start before 2003 since the observations are not available before 2003
        additional_datasets:
          - {project: OBS6, dataset: ESACCI-WATERVAPOUR, type: sat, version: CDR2-L3-COMBI-05deg-fv3.1, tier: 3, timerange: '2003/2007', reference_for_monitor_diags: true}
    scripts:
      plot:
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        group_variables_by: variable_group
        script: monitor/multi_datasets.py
        plots:
          timeseries:
            plot_kwargs:
              ICON-XPP:
                color: C0
              ERA5:
                color: black
              ESACCI-CLOUD:
                color: black
              CERES-EBAF:
                color: black
              ESACCI-WATERVAPOUR:
                color: black

  plot_multiple_timeseries_pr:
    description: Plot time series including reference datasets.
    variables:
      pr:
        <<: *time_period
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: timeseries_regular_pr
        additional_datasets:
          - {project: OBS, dataset: GPCP-SG, type: atmos, version: 2.3, tier: 2, reference_for_monitor_diags: true}
    scripts:
      plot:
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        script: monitor/multi_datasets.py
        plots:
          timeseries:
            plot_kwargs:
              ICON-XPP:
                color: C0
              GPCP-SG:
                color: black
