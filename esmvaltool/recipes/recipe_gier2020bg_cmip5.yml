# recipe_gier2020bg_cmip5.yml
---
documentation:

  description: |
    Analysis of column-averaged CO2 (XCO2) emission driven model data in
    comparison to satellite data (Gier et al., 2020). CMIP5 data.

  authors:
    - gier_bettina

  maintainer:
    - gier_bettina

  references:
    - acknow_author

  projects:
    - eval4cmip
    - 4c

preprocessors:

  noop:
    {}

  mmm_ref:
    regrid:
      target_grid: reference_dataset
      scheme: linear
    multi_model_statistics:
      span: overlap
      statistics: [mean]
      exclude: [reference_dataset]

  mmm_2x2:
    regrid:
      target_grid: 2x2
      scheme: linear
    multi_model_statistics:
      span: overlap
      statistics: [mean]

  mmm:
    regrid:
      target_grid: 5x5
      scheme: linear
    extract_levels:
      levels: [100000., 92500., 85000., 70000., 60000., 50000., 40000., 30000., 25000., 20000., 15000.,
               10000., 7000., 5000., 3000., 2000., 1000.]
      scheme: nearest
    multi_model_statistics:
      span: overlap
      statistics: [mean]


diagnostics:

  xco2_analysis:
    description: Does the bulk of the XCO2 analysis including figures 3, 4, 8, 10-12
    variables:
      xco2:
        project: CMIP5
        mip: Amon
        exp: [esmHistorical, esmrcp85]
        ensemble: r1i1p1
        start_year: 2003
        end_year: 2014
        reference_dataset: C3S
        derive: true
        additional_datasets:
          - {dataset: C3S, project: obs4mips, level: sat, version: l3-v30, tier: 1, derive: false}
          - {dataset: BNU-ESM}
          - {dataset: CanESM2}
          - {dataset: CESM1-BGC}
          - {dataset: GFDL-ESM2G}
          - {dataset: GFDL-ESM2M}
          - {dataset: FIO-ESM}
          - {dataset: MIROC-ESM}
          - {dataset: MPI-ESM-LR}
          - {dataset: MRI-ESM1}
          - {dataset: NorESM1-ME}
    scripts:
      xco2_maps:
        script: xco2_analysis/global_maps.ncl
        contour_max_level: 18

      xco2_main:
        script: xco2_analysis/main.ncl
        styleset: CMIP5
        region: [-90, 90]
        # Possible masking options: obs
        masking: ["obs"]
        ensemble_mean: false

      xco2_panels_unsampled:
        script: xco2_analysis/panel_plots.ncl
        styleset: CMIP5
        region: [30, 60]
        # Possible masking options: obs, land, sciamachy, gosat, "none"
        masking: ["none"]
        # Possible area averaging options: full-area, lat-first
        area_avg: "full-area"
        obs_in_panel: true
        plot_var2_mean: true

      xco2_panels_obs:
        script: xco2_analysis/panel_plots.ncl
        styleset: CMIP5
        region: [30, 60]
        # Possible masking options: obs, land, sciamachy, gosat
        masking: ["obs"]
        # Possible area averaging options: full-area, lat-first
        area_avg: "full-area"
        obs_in_panel: true
        plot_var2_mean: true

      xco2_panels_scia:
        script: xco2_analysis/panel_plots.ncl
        styleset: CMIP5
        region: [30, 60]
        # Possible masking options: obs, land, sciamachy, gosat
        masking: ["sciamachy"]
        # Possible area averaging options: full-area, lat-first
        area_avg: "full-area"
        obs_in_panel: false
        plot_var2_mean: true

      xco2_panels_gosat:
        script: xco2_analysis/panel_plots.ncl
        styleset: CMIP5
        region: [30, 60]
        # Possible masking options: obs, land, sciamachy, gosat
        masking: ["gosat"]
        # Possible area averaging options: full-area, lat-first
        area_avg: "full-area"
        obs_in_panel: false
        plot_var2_mean: true

      xco2_panels_obs_lonavg:
        script: xco2_analysis/panel_plots.ncl
        styleset: CMIP5
        region: [30, 60]
        # Possible masking options: obs, land, sciamachy, gosat
        masking: ["obs"]
        # Possible area averaging options: full-area, lat-first
        area_avg: "lat-first"
        obs_in_panel: true
        plot_var2_mean: true

      xco2_panels_lonavg:
        script: xco2_analysis/panel_plots.ncl
        styleset: CMIP5
        region: [30, 60]
        # Possible masking options: obs, land, sciamachy, gosat
        masking: ["none"]
        # Possible area averaging options: full-area, lat-first
        area_avg: "lat-first"
        obs_in_panel: true
        plot_var2_mean: true

      xco2_panels_obs_land:
        script: xco2_analysis/panel_plots.ncl
        styleset: CMIP5
        region: [30, 60]
        # Possible masking options: obs, land, sciamachy, gosat
        masking: ["obs", "land"]
        # Possible area averaging options: full-area, lat-first
        area_avg: "full-area"
        obs_in_panel: true
        plot_var2_mean: true

      xco2_panels_obs_land_lonavg:
        script: xco2_analysis/panel_plots.ncl
        styleset: CMIP5
        region: [30, 60]
        # Possible masking options: obs, land, sciamachy, gosat
        masking: ["obs", "land"]
        # Possible area averaging options: full-area, lat-first
        area_avg: "lat-first"
        obs_in_panel: true
        plot_var2_mean: true


  xco2_sat_masks:
    description: Influence of satellite coverage on XCO2 data
    variables:
      xco2:
        project: CMIP5
        exp: [esmHistorical, esmrcp85]
        mip: Amon
        ensemble: r1i1p1
        start_year: 2003
        end_year: 2014
        reference_dataset: C3S
        derive: true
        additional_datasets:
          - {dataset: C3S, project: obs4mips, level: sat, version: l3-v30, tier: 1, derive: false}
    scripts:
      xco2_sat_masks:
        script: xco2_analysis/sat_masks.ncl

  delta_T:
    description: Plots XCO2 IAV against growing season temperature anomaly
    variables:
      xco2:
        preprocessor: mmm_ref
        project: CMIP5
        mip: Amon
        exp: [esmHistorical, esmrcp85]
        ensemble: r1i1p1
        start_year: 2003
        end_year: 2014
        reference_dataset: C3S
        derive: true
        additional_datasets:
          - {dataset: C3S, project: obs4mips, level: sat, version: l3-v30, tier: 1, derive: false}
          - {dataset: BNU-ESM}
          - {dataset: CanESM2}
          - {dataset: CESM1-BGC}
          - {dataset: GFDL-ESM2G}
          - {dataset: GFDL-ESM2M}
          - {dataset: FIO-ESM}
          - {dataset: MIROC-ESM}
          - {dataset: MPI-ESM-LR}
          - {dataset: MRI-ESM1}
          - {dataset: NorESM1-ME}
      tas:
        preprocessor: mmm_2x2
        project: CMIP5
        mip: Amon
        exp: [esmHistorical, esmrcp85]
        ensemble: r1i1p1
        start_year: 2003
        end_year: 2014
        additional_datasets:
          - {dataset: BNU-ESM}
          - {dataset: CanESM2}
          - {dataset: CESM1-BGC}
          - {dataset: GFDL-ESM2G}
          - {dataset: GFDL-ESM2M}
          - {dataset: FIO-ESM}
          - {dataset: MIROC-ESM}
          - {dataset: MPI-ESM-LR}
          - {dataset: MRI-ESM1}
          - {dataset: NorESM1-ME}
      tasa:
        mip: Amon
        start_year: 2003
        end_year: 2014
        additional_datasets:
          - {dataset: GISTEMP, project: OBS, type: ground, version: v4, tier: 2}
    scripts:
      delta_T:
        script: xco2_analysis/delta_T.ncl
        styleset: CMIP5
        masking: obs
        var_order: ["xco2", "tas", "tasa"]
        region: [-30, 30]
        modis_path: /work/bd0854/b309137/data_ext/Land_Cover_Class_1degree.nc4

  station_comparison:
    description: Comparison of CO2 and XCO2 at select NOAA-ESRL stations
    variables:
      xco2:
        preprocessor: mmm_ref
        project: CMIP5
        mip: Amon
        exp: [esmHistorical, esmrcp85]
        ensemble: r1i1p1
        start_year: 2003
        end_year: 2014
        reference_dataset: C3S
        derive: true
        additional_datasets:
          - {dataset: C3S, project: obs4mips, level: sat, version: l3-v30, tier: 1, derive: false}
          - {dataset: BNU-ESM}
          - {dataset: CanESM2}
          - {dataset: CESM1-BGC}
          - {dataset: GFDL-ESM2G}
          - {dataset: GFDL-ESM2M}
          - {dataset: FIO-ESM}
          - {dataset: MIROC-ESM}
          - {dataset: MPI-ESM-LR}
          - {dataset: MRI-ESM1}
          - {dataset: NorESM1-ME}
      co2:
        preprocessor: mmm
        project: CMIP5
        mip: Amon
        exp: [esmHistorical, esmrcp85]
        ensemble: r1i1p1
        start_year: 2003
        end_year: 2014
        additional_datasets:
          - {dataset: BNU-ESM}
          - {dataset: CanESM2}
          - {dataset: CESM1-BGC}
          - {dataset: GFDL-ESM2G}
          - {dataset: GFDL-ESM2M}
          - {dataset: FIO-ESM}
          - {dataset: MIROC-ESM}
          - {dataset: MPI-ESM-LR}
          - {dataset: MRI-ESM1}
          - {dataset: NorESM1-ME}
    scripts:
      station_comparison:
        script: xco2_analysis/station_comparison.ncl
        path: "/work/bd0854/b309137/data_ext/Tier2/ESRL/"
        stationlist: "ESRL_stations_diag.csv"
        station_varname: co2
        var_order: ["xco2", "co2"]
