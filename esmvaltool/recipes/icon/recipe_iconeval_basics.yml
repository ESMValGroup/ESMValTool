# ESMValTool
---
documentation:
  title: Basic Model Evaluation
  description: |
    Show plots of several variables that can be used for basic
    model evaluations (sanity checks).
  authors:
    - hassler_birgit
    - lauer_axel
    - bonnet_pauline
  maintainer:
    - hassler_birgit

datasets:
  # Note: plot_label currently only used by diagnostic plot_multiple_annual_cycles
  - {project: ICON, dataset: ICON, exp: icon-2.6.1_atm_amip_R2B5_r1v1i1p1l1f1, plot_label: 'ICON simulation',
     supplementary_variables: [{short_name: areacella, skip: true}, {short_name: sftlf, skip: true}]}

time: &time_period
  timerange: '20000101/20060101'  # can be specified!

preprocessors:

  timeseries_regular: &PP_timeseries_regular
    custom_order: true
    regrid:
      target_grid: 2x2
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted
    area_statistics:
      operator: mean

  timeseries_regular_ann:
    <<: *PP_timeseries_regular
    annual_statistics:
      operator: mean

  timeseries_regular_pr:
    <<: *PP_timeseries_regular
    convert_units:
      units: mm day-1

  full_climatology: &PP_full_climatology
    climate_statistics:
      period: full
    regrid:
      target_grid: 2x2
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted

  full_climatology_pr:
    <<: *PP_full_climatology
    convert_units:
      units: mm day-1

  zonal_mean:
    custom_order: true
    climate_statistics:
      period: full
    extract_levels:
      levels: {cmor_table: CMIP6, coordinate: plev39}
      scheme: linear
      coordinate: air_pressure
    regrid:
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted
      target_grid: 2x2
    zonal_statistics:
      operator: mean

diagnostics:

  # climatologies - maps (full climatology)
  #########################################

  plot_maps_with_references_tas:
    description: Plot climatology maps including reference datasets for tas.
    variables:
      tas:
        mip: Amon
        preprocessor: full_climatology
        <<: *time_period
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, plot_label: 'Reference (ERA5)', reference_for_monitor_diags: true}
    scripts:
      plot: &plot_multi_dataset_default
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        script: monitor/multi_datasets.py
        plots:
          map:
            common_cbar: true
            plot_kwargs_bias:
              levels: [-10.0, -7.5, -5.0, -2.5, 0.0, 2.5, 5.0, 7.5, 10.0]

  plot_maps_with_references_pr:
    description: Plot climatology maps including reference datasets for pr.
    variables:
      pr:
        mip: Amon
        preprocessor: full_climatology_pr
        <<: *time_period
        additional_datasets:
          - {project: OBS, dataset: GPCP-SG, type: atmos, version: 2.3, tier: 2, plot_label: 'Reference (GPCP-SG)', reference_for_monitor_diags: true}
    scripts:
      plot:
        <<: *plot_multi_dataset_default
        script: monitor/multi_datasets.py
        plots:
          map:
            common_cbar: true
            plot_kwargs_bias:
              levels: [-5.0, -2.5, -1.0, 0.0, 1.0, 2.5, 5.0]
            plot_kwargs:
              default: 
                cmap: Blues

  # climatologies (zonal means)
  #############################

  plot_zonal_mean_profiles_with_references_ta:
    description: Plot 2D zonal mean profiles including reference datasets.
    variables:
      ta:
        mip: Amon
        preprocessor: zonal_mean
        <<: *time_period
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, plot_label: 'Reference (ERA5)', reference_for_monitor_diags: true}
    scripts:
      plot:
        <<: *plot_multi_dataset_default
        script: monitor/multi_datasets.py
        plots:
          zonal_mean_profile:
            common_cbar: true
            plot_kwargs_bias:
              levels: [-12.5,-10.0, -7.5, -5.0, -2.5, 0.0, 2.5, 5.0, 7.5, 10.0, 12.5]

  plot_zonal_mean_profiles_with_references_ua:
    description: Plot 2D zonal mean profiles including reference datasets.
    variables:
      ua:
        mip: Amon
        preprocessor: zonal_mean
        <<: *time_period
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, plot_label: 'Reference (ERA5)', reference_for_monitor_diags: true}
    scripts:
      plot:
        <<: *plot_multi_dataset_default
        script: monitor/multi_datasets.py
        plots:
          zonal_mean_profile:
            common_cbar: true
            plot_kwargs_bias:
              levels: [-15.0, -10.0, -7.5, -5.0, -2.5, 0.0, 2.5, 5.0, 7.5, 10.0, 15.0]
            plot_kwargs:
              default: 
                cmap: Blues

  plot_zonal_mean_profiles_with_references_hus:
    description: Plot 2D zonal mean profiles including reference datasets.
    variables:
      hus:
        mip: Amon
        preprocessor: zonal_mean
        <<: *time_period
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, plot_label: 'Reference (ERA5)', reference_for_monitor_diags: true}
    scripts:
      plot:
        <<: *plot_multi_dataset_default
        script: monitor/multi_datasets.py
        plots:
          zonal_mean_profile:
            common_cbar: true
            plot_kwargs_bias:
              levels: [-0.0010, -0.00075, -0.0005, -0.00025, 0.0, 0.00025, 0.0005, 0.00075, 0.0010]
            plot_kwargs:
              default: 
                cmap: Blues

  # time series of global averages (monthly)
  ##########################################
  
  plot_multiple_timeseries:
    description: Plot time series including reference datasets.
    variables:
      tas:
        mip: Amon
        preprocessor: timeseries_regular
        <<: *time_period
        additional_datasets:
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, plot_label: 'Reference (ERA5)', reference_for_monitor_diags: true}
      clt:
        mip: Amon
        preprocessor: timeseries_regular
        <<: *time_period
        additional_datasets:
          - {project: OBS, dataset: ESACCI-CLOUD, type: sat, version: AVHRR-AMPM-fv3.0, tier: 2, plot_label: 'Reference (ESACCI-CLOUD)', reference_for_monitor_diags: true}
      rsut:
        mip: Amon
        preprocessor: timeseries_regular
        <<: *time_period
        additional_datasets:
          - {project: OBS, dataset: CERES-EBAF, type: sat, version: Ed4.1, tier: 2, plot_label: 'Reference (CERES-EBAF)', reference_for_monitor_diags: true}
      rlut:
        mip: Amon
        preprocessor: timeseries_regular
        <<: *time_period
        additional_datasets:
          - {project: OBS, dataset: CERES-EBAF, type: sat, version: Ed4.1, tier: 2, plot_label: 'Reference (CERES-EBAF)', reference_for_monitor_diags: true}
      rtnt:
        derive: true
        force_derivation: true
        var_type: atm_2d_ml
        mip: Amon
        preprocessor: timeseries_regular_ann
        timerange: '19950101/20150101'
      prw:
        mip: Amon
        preprocessor: timeseries_regular
        # timerange MUST NOT start before 2003 since the observations are not available before 2003
        timerange: '20030101/20050101'
        additional_datasets:
          - {project: OBS, dataset: ESACCI-WATERVAPOUR, type: sat, version: CDR2-L3S-05deg_fv3.1, tier: 3, plot_label: 'Reference (ESACCI-WATERVAPOUR)', reference_for_monitor_diags: true}
    scripts:
      plot:
        <<: *plot_multi_dataset_default
        group_variables_by: variable_group
        script: monitor/multi_datasets.py
        plots:
          timeseries:
            annual_mean_kwargs: false
            plot_kwargs:
              ICON:  # = dataset since 'facet_used_for_labels' is 'dataset' by default
                color: C0
              ERA5:
                color: black
              ESACCI-CLOUD:
                color: black
              CERES-EBAF:
                color: black
              ESACCI-WATERVAPOUR:
                color: black

  plot_multiple_timeseries_pr:
    description: Plot time series including reference datasets.
    variables:
      pr:
        mip: Amon
        preprocessor: timeseries_regular_pr
        <<: *time_period
        additional_datasets:
          - {project: OBS, dataset: GPCP-SG, type: atmos, version: 2.3, tier: 2, plot_label: 'Reference (GPCP-SG)', reference_for_monitor_diags: true}
    scripts:
      plot:
        <<: *plot_multi_dataset_default
        script: monitor/multi_datasets.py
        plots:
          timeseries:
            annual_mean_kwargs: false
            plot_kwargs:
              ICON:  # = dataset since 'facet_used_for_labels' is 'dataset' by default
                color: C0
              GPCP-SG:
                color: black
