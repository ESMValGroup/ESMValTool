# ESMValTool
# ---
#
documentation:

  title: Precip Bias

  description: |
    Show precipitation bias. 

  authors:
    - bock_lisa
    - lauer_axel

  maintainer:
    - bock_lisa


datasets:
  - {project: ICON, dataset: ICON, exp: icon-2.6.1_atm_amip_R2B5_r1v1i1p1l1f1,
     supplementary_variables: [{short_name: areacella, skip: true}, {short_name: sftlf, skip: true}]}
     # - {project: CMIP6, dataset: CanESM5, exp: historical, ensemble: r1i1p1f1, grid: gn, plot_label: 'CanESM5'}


time: &time_period
  timerange: '20000101/20000201'  # can be specified!


preprocessors:

  full_climatology_pr:
    extract_region:
      start_longitude: 0
      end_longitude: 360
      start_latitude: -90
      end_latitude: 90
    climate_statistics:
      period: full
    regrid:
      target_grid: 2x2
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted
    convert_units:
      units: mm day-1

  var_vs_lat:
    climate_statistics:
      operator: mean
    regrid:
      target_grid: 2x2
      scheme:
        reference: esmf_regrid.schemes:ESMFAreaWeighted
    zonal_statistics:
      operator: mean
    convert_units:
      units: mm day-1


diagnostics:

  plot_variable_vs_latitude:
    description: Creates a single-panel variable plot over latitude.
    variables:
      pr:
        preprocessor: var_vs_lat
        ensemble: r1i1p1f1
        mip: Amon
        <<: *time_period
        additional_datasets:
          - {project: OBS, dataset: GPCP-SG, type: atmos, version: 2.3, tier: 2, reference_for_monitor_diags: true}
          - {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, reference_for_monitor_diags: true}
    scripts:
      plot:
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        script: monitor/multi_datasets.py
        plots:
          variable_vs_lat:
            plot_kwargs:
              ICON: {color: red}
              GPCP-SG: {color: black}      
              ERA5: {color: black, linestyle: '--'}


  plot_maps_with_references_pr_era5:
    description: Plot climatology maps including reference datasets for pr.
    variables:
      pr:
        mip: Amon
        preprocessor: full_climatology_pr
        ensemble: r1i1p1f1
        <<: *time_period
        additional_datasets:
          - {project: OBS, dataset: GPCP-SG, type: atmos, version: 2.3, tier: 2, plot_label: 'Reference (GPCP-SG)', reference_for_monitor_diags: true}
            #- {project: native6, dataset: ERA5, type: reanaly, version: v1, tier: 3, plot_label: 'Reference (ERA5)', reference_for_monitor_diags: true}
    scripts:
      plot:
        plot_folder: '{plot_dir}'
        plot_filename: '{plot_type}_{real_name}_{dataset}_{mip}'
        script: monitor/multi_datasets.py
        plots:
          map:
            common_cbar: true
            show_stats: false
            plot_kwargs_bias:
              levels: [-5.0, -2.5, -1.0, 0.0, 1.0, 2.5, 5.0]
              extend: "both"
              cmap: BrBG
            plot_kwargs:
              default: 
                cmap: Blues
