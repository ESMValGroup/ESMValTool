# ESMValTool
# recipe_extremes_evaluation_SK_BC.yml
---
documentation:

  title: Extremes variability in the CMIP models

  description: This is an analysis to evaluate warm extremes (TXx) variability
               in CMIP6 models used in event attribution. This recipe reproduces
               Figs. 6 and 8 from Malinina and Gillett (2024).

  authors:
    - malinina_elizaveta

preprocessors:

  preproc_area_average_var: &prep_aa_var
    area_statistics:
      operator: mean
    annual_statistics:
      operator: max
    anomalies:
      period: full
      reference:
        start_year: 1940
        start_month: 1
        start_day: 1
        end_year: 1959
        end_month: 12
        end_day: 31

  preproc_model_bc:
    custom_order: True
    regrid:
      target_grid: 0.5x0.5
      lon_offset: 0.25
      lat_offset: 0.25
      scheme: linear
    extract_shape:
      shapefile: british_columbia.shp
      method: contains
      crop: True
    *prep_aa_var

  preproc_era_bc:
    custom_order: True
    extract_shape:
      shapefile: british_columbia.shp
      method: contains
      crop: True
    *prep_aa_var

  preproc_model_sk:
    custom_order: True
    regrid:
      target_grid: 0.5x0.5
      lon_offset: 0.25
      lat_offset: 0.25
      scheme: linear
    extract_shape:
      shapefile: saskatchewan.shp
      method: contains
      crop: True
    *prep_aa_var

  preproc_era_sk:
    custom_order: True
    extract_shape:
      shapefile: saskatchewan.shp
      method: contains
      crop: True
    *prep_aa_var


datasets_cmip: &datasets_cmip
  - {dataset: ACCESS-ESM1-5, ensemble: "r(1:18)i1p1f1", grid: gn}
  - {dataset: ACCESS-ESM1-5, ensemble: "r(21:24)i1p1f1", grid: gn}
  - {dataset: ACCESS-ESM1-5, ensemble: r26i1p1f1, grid: gn}
  - {dataset: ACCESS-ESM1-5, ensemble: "r(28:33)i1p1f1", grid: gn}
  - {dataset: ACCESS-ESM1-5, ensemble: "r(35:40)i1p1f1", grid: gn}
  - {dataset: ACCESS-CM2, ensemble: "r(1:5)i1p1f1", grid: gn}
  - {dataset: AWI-CM-1-1-MR, ensemble: r1i1p1f1, grid: gn}
  - {dataset: BCC-CSM2-MR, ensemble: r1i1p1f1, grid: gn}
  - {dataset: CanESM5, ensemble: "r(1:25)i1p1f1", grid: gn}
  - {dataset: CanESM5, ensemble: "r(1:25)i1p2f1", grid: gn}
  - {dataset: CMCC-ESM2, ensemble: r1i1p1f1, grid: gn}
  - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2, grid: gr}
  - {dataset: CNRM-ESM2-1, ensemble: r1i1p1f2, grid: gr}
  - { dataset: EC-Earth3, ensemble: r2i1p1f1, grid: gr }
  - { dataset: EC-Earth3-CC, ensemble: r1i1p1f1, grid: gr }
  - { dataset: EC-Earth3-Veg, ensemble: r1i1p1f1, grid: gr }
  - { dataset: EC-Earth3-Veg, ensemble: r6i1p1f1, grid: gr }
  - { dataset: GFDL-ESM4, institute: NOAA-GFDL, ensemble: r1i1p1f1, grid: gr1 }
  - { dataset: INM-CM5-0, ensemble: r1i1p1f1, grid: gr1 }
  - { dataset: INM-CM4-8, ensemble: r1i1p1f1, grid: gr1 }
  - { dataset: IPSL-CM6A-LR, ensemble: "r(1:6)i1p1f1", grid: gr }
  - { dataset: IPSL-CM6A-LR, ensemble: "r(10:11)i1p1f1", grid: gr }
  - { dataset: IPSL-CM6A-LR, ensemble: r14i1p1f1, grid: gr }
  - { dataset: IPSL-CM6A-LR, ensemble: r22i1p1f1, grid: gr }
  - { dataset: IPSL-CM6A-LR, ensemble: r25i1p1f1, grid: gr }
  - {dataset: MIROC6, ensemble: "r(1:3)i1p1f1", grid: gn}
  - {dataset: MIROC6, ensemble: "r(21:29)i1p1f1", grid: gn}
  - {dataset: MIROC6, ensemble: "r(31:34)i1p1f1", grid: gn}
  - {dataset: MIROC6, ensemble: "r(36:37)i1p1f1", grid: gn}
  - {dataset: MIROC6, ensemble: "r(39:40)i1p1f1", grid: gn}
  - {dataset: MIROC6, ensemble: "r(42:47)i1p1f1", grid: gn}
  - {dataset: MIROC6, ensemble: "r(49:50)i1p1f1", grid: gn}
  - {dataset: MPI-ESM1-2-LR, ensemble: "r(1:3)i1p1f1", grid: gn}
  - {dataset: MPI-ESM1-2-LR, ensemble: "r(5:10)i1p1f1", grid: gn}
  - {dataset: MRI-ESM2-0, ensemble: "r(1:5)i1p1f1", grid: gn}
  - {dataset: NESM3, ensemble: r1i1p1f1, grid: gn}
  - {dataset: NorESM2-LM, ensemble: "r(1:3)i1p1f1", grid: gn}
  - {dataset: NorESM2-MM, ensemble: r2i1p1f1, grid: gn}
  - {dataset: TaiESM1, ensemble: r1i1p1f1, grid: gn}

dataset_obs: &dataset_obs
  - {dataset: ERA5, project: OBS6, type: reanaly, version: v1, tier: 3}

diagnostics:
  evaluation_bc:
    description: Evaluation of model TXx variability in Bristish Columbia
    variables:
      models:
        short_name: tasmax
        exp: [historical, ssp245]
        timerange: '19400101/20223112'
        mip: day
        project: CMIP6
        preprocessor: preproc_model_bc
        additional_datasets: *datasets_cmip
      reference:
        short_name: tasmax
        timerange: '19400101/20223112'
        mip: day
        preprocessor: preproc_era_bc
        additional_datasets: *dataset_obs
    scripts:
      timeseries:
        script: eccc_extremes/simple_timeseries.py
        mpl_style: malinina24
        color_style: malinina24
        model_weighting: False
        units: C
        region: BC # needed for the figure title
        var_label: TXx # needed for axis name
        figure_caption: 'TXx anomalies in BC relative to 1940-1959' # optional
      variability:
        script: eccc_extremes/variability_evaluation.py
        mpl_style: malinina24
        color_style: malinina24
        model_weighting: True
        units: C
        region: BC # needed for the figure title
        var_label: TXx # needed for axis name
        figure_caption: 'Standard deviations of TXx anomalies in BC relative to 1940-1959' # optional
  evaluation_sk:
    description: Evaluation of model TXx variability in Bristish Columbia
    variables:
      models:
        short_name: tasmax
        exp: [historical, ssp245]
        timerange: '19400101/20223112'
        mip: day
        project: CMIP6
        preprocessor: preproc_model_sk
        additional_datasets: *datasets_cmip
      reference:
        short_name: tasmax
        timerange: '19400101/20223112'
        mip: day
        preprocessor: preproc_era_sk
        additional_datasets: *dataset_obs
    scripts:
      timeseries:
        script: eccc_extremes/simple_timeseries.py
        mpl_style: malinina24
        color_style: malinina24
        units: C
        region: SK # needed for the figure title
        var_label: TXx # needed for axis name
        figure_caption: 'TXx anomalies in SK relative to 1940-1959' # optional
      variability:
        script: eccc_extremes/variability_evaluation.py
        mpl_style: malinina24
        color_style: malinina24
        model_weighting: True
        units: C
        region: SK # needed for the figure title (optional)
        var_label: TXx # needed for axis name
        figure_caption: 'Standard deviations of TXx anomalies in SK relative to 1940-1959' # optional
