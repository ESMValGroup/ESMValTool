# ESMValTool
# recipe_preprocess_cloud.yml
---
documentation:
  description: |
    Preprocess cloud properties and cloud controlling factors for causal
    inference study.

  authors:
    - bock_lisa

  title: Preprocess cloud timeseries.

  maintainer:
    - bock_lisa

  projects:
    - cmug


ESACCI_CLOUD_datasets: &esacci
        - {dataset: ESACCI-CLOUD, project: OBS6, type: sat, version: v3.0, tier: 2, start_year: 2000, end_year: 2004}
ERA5_datasets: &era5
        - {dataset: ERA5, project: OBS6, type: reanaly, version: v1, tier: 3, start_year: 2000, end_year: 2004}
          #- {dataset: ESACCI-CLOUD, project: OBS6, type: sat, version: v3.0, tier: 2, timerange: 200001/200008}


preprocessors:

  south_east_pacific:
    custom_order: true
    extract_region:
      #start_latitude: -30.
      start_latitude: -25.
      #end_latitude: -10.
      end_latitude: -20.
      #start_longitude: 265.
      start_longitude: 280.
      end_longitude: 285.
    mask_landsea: &mask_land
      mask_out: land
    anomalies:
      period: daily
    area_statistics: &area_mean
      operator: mean
      #regrid:
      #  scheme: area_weighted
      #  target_grid: 1x1      


diagnostics:

  south_east_pacific_clouds:
    description: Create timeseries.
    variables:
            #clt: &var
            #  preprocessor: south_east_pacific
            #  mip: day
            #  frequency: day
            #  additional_datasets: *esacci
            #clwvi:
            #  <<: *var
            #  mip: CFday
            #cod:
            #  <<: *var
            #  mip: AERday
            #ctp:
            #  <<: *var
            #  mip: day
            #reff:
            #  <<: *var
            #  mip: day
            #rlut:
            #  <<: *var
            #  mip: day
            #psl: &var2
            #  preprocessor: south_east_pacific
            #  frequency: day
            #  mip: day
            #  additional_datasets: *era5
      ta700: 
        preprocessor: south_east_pacific
        frequency: day
        mip: CFday 
        additional_datasets: *era5
      ta850: 
        preprocessor: south_east_pacific
        frequency: day
        mip: Eday 
        additional_datasets: *era5
        #tos:
        #  <<: *var2
        #  mip: day
        #wap500:
        #  <<: *var2
        #  mip: CFday
        #zg500:
        #  <<: *var2
        #  mip: day
        #prw:
        #  <<: *var2
        #  mip: Eday
    scripts: 
      timeseries:
        script: causal_clouds_timeseries.py
        compute:
          - theta700
          - theta850
        


    #  south_east_pacific_ccfactors:
    #    description: Create timeseries.
    #    variables:
    #      prw:
    #        <<: *var
    #        mip: Eday
    #        additional_datasets: *era5
    #      psl:
    #        <<: *var
    #        mip: day
    #        additional_datasets: *era5
    #      tos:
    #        <<: *var
    #        mip: day
    #        additional_datasets: *era5
    #      wap500:
    #        <<: *var
    #        mip: CFday
    #        additional_datasets: *era5
    #      zg500:
    #        <<: *var
    #        mip: day
    #        additional_datasets: *era5
