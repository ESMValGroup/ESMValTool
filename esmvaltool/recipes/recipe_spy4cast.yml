# ESMValTool
# recipe_python.yml
---
documentation:
  description: |
    Example recipe that plots a map and timeseries of temperature.

  title: Recipe that runs an example diagnostic written in Python.

  authors:
    - vegas-regidor_javier

  maintainer:
    - vegas-regidor_javier

  references:
    - acknow_project

  projects:
    - proyecto_off

datasets:
  - dataset: ACCESS-CM2
    ensemble: r(1:3)i1p1f1
    institute: CSIRO-ARCCSS
  # - dataset: ACCESS-ESM1-5
  #   ensemble: r(1:6)i1p1f1
  #   institute: CSIRO
  # - dataset: ACCESS-ESM1-5
  #   ensemble: r(8:10)i1p1f1
  #   institute: CSIRO
  # - dataset: CAS-ESM2-0
  #   ensemble: r1i1p1f1
  #   institute: CAS
  # - dataset: CESM2
  #   ensemble: r(1:11)i1p1f1
  #   institute: NCAR
  # - dataset: CESM2-FV2
  #   ensemble: r(1:3)i1p1f1
  #   institute: NCAR
  # - dataset: CESM2-WACCM
  #   ensemble: r(1:3)i1p1f1
  #   institute: NCAR
  # - dataset: CESM2-WACCM-FV2
  #   ensemble: r(1:3)i1p1f1
  #   institute: NCAR
  # - dataset: CanESM5
  #   ensemble: r(1:25)i1p1f1
  #   institute: CCCma
  # - dataset: CanESM5-CanOE
  #   ensemble: r(1:3)i1p2f1
  #   institute: CCCma
  # - dataset: HadGEM3-GC31-LL
  #   ensemble: r(1:4)i1p1f3
  #   institute: MOHC
  # - dataset: MIROC-ES2L
  #   ensemble: r(1:3)i1p1f2
  #   institute: MIROC
  # - dataset: MIROC6
  #   ensemble: r(1:50)i1p1f1
  #   institute: MIROC
  # - dataset: MPI-ESM-1-2-HAM
  #   ensemble: r(1:3)i1p1f1
  #   institute: HAMMOZ-Consortium
  # - dataset: MPI-ESM1-2-HR
  #   ensemble: r(1:10)i1p1f1
  #   institute: MPI-M
  # - dataset: MPI-ESM1-2-LR
  #   ensemble: r1i2000p1f1
  #   institute: MPI-M
  # - dataset: MPI-ESM1-2-LR
  #   ensemble: r(1:50)i1p1f1
  #   institute: MPI-M
  # - dataset: MRI-ESM2-0
  #   ensemble: r1i1000p1f1
  #   institute: MRI
  # - dataset: MRI-ESM2-0
  #   ensemble: r(1:5)i1p1f1
  #   institute: MRI
  # - dataset: NorESM2-LM
  #   ensemble: r(1:3)i1p1f1
  #   institute: NCC
  # - dataset: NorESM2-MM
  #   ensemble: r(1:2)i1p1f1
  #   institute: NCC
  # - dataset: UKESM1-0-LL
  #   ensemble: r(1:4)i1p1f2
  #   institute: MOHC
  # - dataset: UKESM1-0-LL
  #   ensemble: r(5:7)i1p1f3
  #   institute: MOHC
  # - dataset: UKESM1-0-LL
  #   ensemble: r(8:12)i1p1f2
  #   institute: MOHC
  # - dataset: UKESM1-0-LL
  #   ensemble: r(16:19)i1p1f2
  #   institute: MOHC

  # Issue when reading all data:

  # - dataset: HadGEM3-GC31-MM
  #   ensemble: r(1:4)i1p1f3
  #   institute: MOHC


  # Can not find gn data:
  # - dataset: CIESM
  #   ensemble: r(1:3)i1p1f1
  #   institute: THU
  # - dataset: CNRM-CM6-1
  #   ensemble: r(1:30)i1p1f2
  #   institute: CNRM-CERFACS
  # - dataset: CNRM-CM6-1-HR
  #   ensemble: r1i1p1f2
  #   institute: CNRM-CERFACS
  # - dataset: CNRM-ESM2-1
  #   ensemble: r(1:11)i1p1f2
  #   institute: CNRM-CERFACS
  # - dataset: CanESM5
  #   ensemble: r(1:40)i1p2f1
  #   institute: CCCma
  # - dataset: EC-Earth3
  #   ensemble: r(1:4)i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3
  #   ensemble: r(6:7)i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3
  #   ensemble: r(9:25)i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3
  #   ensemble: r(101:150)i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3-AerChem
  #   ensemble: r1i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3-AerChem
  #   ensemble: r4i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3-CC
  #   ensemble: r1i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3-Veg
  #   ensemble: r(1:6)i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3-Veg
  #   ensemble: r10i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3-Veg
  #   ensemble: r14i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: EC-Earth3-Veg-LR
  #   ensemble: r(1:3)i1p1f1
  #   institute: EC-Earth-Consortium
  # - dataset: FGOALS-f3-L
  #   ensemble: r(1:3)i1p1f1
  #   institute: CAS
  # - dataset: IITM-ESM
  #   ensemble: r1i1p1f1
  #   institute: CCCR-IITM
  # - dataset: IPSL-CM5A2-INCA
  #   ensemble: r1i1p1f1
  #   institute: IPSL
  # - dataset: IPSL-CM6A-LR
  #   ensemble: r(1:32)i1p1f1
  #   institute: IPSL
  # - dataset: NorCPM1
  #   ensemble: r(1:30)i1p1f1
  #   institute: NCC
  # - dataset: GFDL-CM4
  #   ensemble: r1i1p1f1
  #   institute: NOAA-GFDL
  # - dataset: GFDL-ESM4
  #   ensemble: r(1:3)i1p1f1
  #   institute: NOAA-GFDL
  # - dataset: GISS-E2-1-G
  #   ensemble: r(1:4)i1p5f1
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-G
  #   ensemble: r(1:5)i1p1f3
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-G
  #   ensemble: r(1:10)i1p1f1
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-G
  #   ensemble: r(1:6)i1p3f1
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-G
  #   ensemble: r(8:10)i1p3f1
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-G
  #   ensemble: r(1:11)i1p1f2
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-G
  #   ensemble: r(6:10)i1p5f1
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-G
  #   ensemble: r(101:102)i1p1f1
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-G-CC
  #   ensemble: r1i1p1f1
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-H
  #   ensemble: r(1:5)i1p1f2
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-H
  #   ensemble: r(1:5)i1p3f1
  #   institute: NASA-GISS
  # - dataset: GISS-E2-1-H
  #   ensemble: r(1:5)i1p5f1
  #   institute: NASA-GISS

  # Preprocessing errors
  # - dataset: ICON-ESM-LR
  #   ensemble: r(1:5)i1p1f1
  #   institute: MPI-M

  # Can not mask land:
  # - dataset: AWI-CM-1-1-MR
  # ensemble: r(1:5)i1p1f1
  # institute: AWI
  # - dataset: AWI-ESM-1-1-LR
  # ensemble: r1i1p1f1
  # institute: AWI

  # Bad sftof
  # - dataset: BCC-CSM2-MR
  # ensemble: r(1:3)i1p1f1
  # institute: BCC
  # - dataset: BCC-ESM1
  # ensemble: r(1:3)i1p1f1
  # institute: BCC

  # Missing sftof
  # - dataset: CAMS-CSM1-0
  #   ensemble: r1i1p1f2
  #   institute: CAMS
  # - dataset: CAMS-CSM1-0
  #   ensemble: r(1:2)i1p1f1
  #   institute: CAMS
  # - dataset: CMCC-CM2-HR4
  # ensemble: r1i1p1f1
  # institute: CMCC
  # - dataset: CMCC-CM2-SR5
  # ensemble: r1i1p1f1
  # institute: CMCC
  # - dataset: CMCC-ESM2
  # ensemble: r1i1p1f1
  # institute: CMCC
  # - dataset: FGOALS-g3
  #   ensemble: r(4:6)i1p1f1
  #   institute: CAS
  # - dataset: FIO-ESM-2-0
  #   ensemble: r(1:3)i1p1f1
  #   institute: FIO-QLNM
  # - dataset: GISS-E2-1-H
  #   ensemble: r(1:10)i1p1f1
  #   institute: NASA-GISS
  # - dataset: NESM3
  # ensemble: r(1:5)i1p1f1
  # institute: NUIST
  # - dataset: SAM0-UNICON
  #   ensemble: r1i1p1f1
  #   institute: SNU
  # - dataset: TaiESM1
  #   ensemble: r1i1p1f1
  #   institute: AS-RCEC
  # - dataset: MCM-UA-1-0
  # ensemble: r1i1p1f(1:2)
  # institute: UA
    # - dataset: UKESM1-0-LL
    # ensemble: r13i1p1f2
    # institute: NIMS-KMA


preprocessors:
  predictor_preproc:
    regrid:
      target_grid:
        start_longitude: 120
        end_longitude: 280
        start_latitude: 30
        end_latitude: 60
        step_longitude: 0.5
        step_latitude: 0.5
      scheme: linear
    extract_season:
      season: nd
    # extract_region:
    #   start_longitude: 120
    #   end_longitude: 280
    #   start_latitude: 30
    #   end_latitude: 60
    mask_landsea:
      mask_out: land

  predictand_preproc:
    regrid:
      target_grid:
        start_longitude: -100
        end_longitude: 40
        start_latitude: 20
        end_latitude: 60
        step_longitude: 0.5
        step_latitude: 0.5
      scheme: linear
    extract_season:
      season: nd
    # extract_region:
    #   start_longitude: -100
    #   end_longitude: 40
    #   start_latitude: 20
    #   end_latitude: 60

diagnostics:
  spy4cast:
    description: Annual mean temperature in Amsterdam and global mean since 1850.
    themes:
      - phys
    realms:
      - atmos
    variables:
      predictor:
        short_name: tos
        mip: Omon
        preprocessor: predictor_preproc
        start_year: 1850
        end_year: 2010
        project: CMIP6
        exp: historical
        grid: gn
        supplementary_variables:
        - short_name: sftof
          mip: Ofx
          activity: '*'
          ensemble: '*'
          exp: '*'
      predictand:
        short_name: ps
        mip: Amon
        preprocessor: predictand_preproc
        start_year: 1850
        end_year: 2010
        project: CMIP6
        exp: historical
        grid: gn
    scripts:
      mca:
        script: spy4cast/mca.py
        cross_validation: False
        modes: 3
        alpha: 0.1  # Significance level
        season: ND
