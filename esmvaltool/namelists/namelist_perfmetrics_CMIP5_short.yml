###############################################################################
# namelist_perfmetrics_CMIP5.xml
#
# Description
# Namelist for plotting the performance metrics for the CMIP5 models,
# including the "standard" ECVs as in Gleckler et al., plus some additional
# variables (like ozone, sea-ice, aerosol...)
#
# Authors
# Franziska Frank (DLR, Germany)
# Mattia Righi (DLR, Germany)
# Veronika Eyring (DLR, Germany)
#
# Project
# DLR ESMVal
#
# Reference
# Gleckler et al., J. Geophys. Res., 113, D06104, doi: 10.1029/2007JD008972
# (2008)
#
# This namelist is part of the ESMValTool
###############################################################################
---

models:
  - {model: bcc-csm1-1,       project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 2000, end_year: 2002}
  - {model: GFDL-ESM2G,       project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 2000, end_year: 2002}
  - {model: MPI-ESM-LR,       project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 2000, end_year: 2002}
  - {model: MPI-ESM-MR,       project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 2000, end_year: 2002}

preprocessors:
  pp850:
    extract_levels:
      levels: 85000
      scheme: linear
    regrid:
      target_grid: ERA-Interim
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.95
    multi_model_statistics:
      span: overlap
      statistics: [mean, median]
      exclude: [reference_model, alternative_model]

  ppNOLEV:
    regrid:
      target_grid: ERA-Interim
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.95
    multi_model_statistics:
      span: overlap
      statistics: [mean, median]
      exclude: [reference_model, alternative_model]
    
  ppALL:
    extract_levels:
      levels: ERA-Interim
      scheme: linear
    regrid:
      target_grid: ERA-Interim
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.95
    multi_model_statistics:
      span: overlap
      statistics: [mean, median]
      exclude: [reference_model, alternative_model]


diagnostics:
      
### ta: AIR TEMPERATURE ##############################################################################################################################
  
  ta850:
    description: Air temperature at 850 hPa global.
    variables:
      ta:
        preprocessor: pp850
        reference_model: ERA-Interim
        alternative_model: NCEP
        mip: Amon
        field: T3M
    additional_models:
      - {model: ERA-Interim,      project: OBS, type: reanaly, version: 1, start_year: 2000, end_year: 2002, tier: 3}
      - {model: NCEP,             project: OBS, type: reanaly, version: 1, start_year: 2000, end_year: 2002, tier: 2}
    scripts:
      cycle: &cycle_settings
        script: perfmetrics/main.ncl
        plot_type: cycle       # Plot type ('cycle' [time], 'zonal' [plev, lat], 'latlon' [lat, lon], 'cycle_latlon' [time, lat, lon])
        time_avg: monthlyclim  # Time average ('opt' argument of time_operations.ncl)
        region: Global         # Selected region ('Global', 'Tropics', 'NH extratropics', 'SH extratropics')
        plot_stddev: ref_model # Plot standard deviation ('all', 'none', 'ref_model' or given model name)
        legend_outside: true   # Plot legend in a separate file
        styleset: CMIP5        # Plot style
      grading: &grading_settings
        <<: *cycle_settings
        plot_type: cycle_latlon                # Plot type ('cycle' [time], 'zonal' [plev, lat], 'latlon' [lat, lon], 'cycle_latlon' [time, lat, lon])
        draw_plots: false                      # Do not draw plots
        calc_grading: true                     # Calculate grading
        metric: [RMSD, taylor]                 # Metric ('RMSD', 'BIAS', taylor')
        normalization: [centered_median, none] # Normalization ('mean', 'median', 'centered_median', 'none')

  taZONAL:
    description: Air temperature zonal mean
    variables:
      ta:
        preprocessor: ppALL
        reference_model: ERA-Interim
        alternative_model: NCEP
        mip: Amon
        field: T3M    
    additional_models:
      - {model: ERA-Interim,  project: OBS,  type: reanaly,  version: 1,  start_year: 2000,  end_year: 2002,  tier: 3}
      - {model: NCEP,         project: OBS,  type: reanaly,  version: 1,  start_year: 2000,  end_year: 2002,  tier: 2}
    scripts:
      zonal: &zonal_settings
        script: perfmetrics/main.ncl
        plot_type: zonal         # Plot type ('cycle' [time], 'zonal' [plev, lat], 'latlon' [lat, lon], 'cycle_latlon' [time, lat, lon])
        time_avg: annualclim     # Time average ('opt' argument of time_operations.ncl)
        region: Global           # Selected region ('Global', 'Tropics', 'NH extratropics', 'SH extratropics')
        plot_diff: true          # Draw difference plots
        t_test: true             # Calculate t-test in difference plots
        conf_level: 0.95         # Confidence level for the t-test
        stippling: true          # Mask non-significant values with stippling
        abs_levs: [200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300] # Contour levels for absolute plot
        diff_levs: [-10, -8, -6, -4, -2, 0, 2, 4, 6, 8, 10]               # Contour levels for difference plot

### tas: NEAR-SURFACE TEMPERATURE ####################################################################################################################

  tas:
    description: Near-surface air temperature
    variables:
      tas:
        preprocessor: ppNOLEV
        reference_model: ERA-Interim
        alternative_model: NCEP
        mip: Amon
        field: T2Ms
    additional_models:
      - {model: ERA-Interim,  project: OBS,  type: reanaly,  version: 1,  start_year: 2000,  end_year: 2002,  tier: 3}
      - {model: NCEP,         project: OBS,  type: reanaly,  version: 1,  start_year: 2000,  end_year: 2002,  tier: 2}
    scripts:
      latlon: &latlon_settings
        script: perfmetrics/main.ncl
        plot_type: latlon        # Plot type ('cycle' [time], 'zonal' [plev, lat], 'latlon' [lat, lon], 'cycle_latlon' [time, lat, lon])
        time_avg: annualclim     # Time average ('opt' argument of time_operations.ncl)
        region: Global           # Selected region ('Global', 'Tropics', 'NH extratropics', 'SH extratropics')
        plot_diff: True          # Draw difference plots
        t_test: True             # Calculate t-test in difference plots
        conf_level: 0.95         # Confidence level for the t-test
        abs_levs: [240, 243, 246, 249, 252, 255, 258,
                   261, 264, 267, 270, 273, 276, 279,
                   282, 285, 288, 291, 294, 297, 300]     # Contour levels for absolute plot
        diff_levs: [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5] # Contour levels for difference plot
      grading:
        <<: *grading_settings
        metric: [RMSD]                   # Metric ('RMSD', 'BIAS', taylor')
        normalization: [centered_median] # Normalization ('mean', 'median', 'centered_median', 'none')

### COLLECT METRICS ##################################################################################################################################

  collect:
    description: Wrapper to collect and plot previously calculated metrics
    scripts:
      RMSD:
        script: perfmetrics/collect.ncl
        ancestors: ['*/grading']
        metric: RMSD
        label_bounds: [-0.5, 0.5]
        label_scale: 0.1
        disp_values: false
        cm_interval: [2, 241]
        sort: true  # Sort model in alphabetic order (excluding MMM)
      taylor:
        script: perfmetrics/collect.ncl
        ancestors: ['*/grading']
        metric: taylor
